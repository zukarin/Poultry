;/*FB_PKG_DELIM*/

__d("ExecTimeResolverHooks",["ReactiveExecutorExecTimeResolverTransformer","react-compiler-runtime","react-relay/relay-hooks/useFragment","react-relay/relay-hooks/useLazyLoadQuery","relay-runtime"],(function(a,b,c,d,e,f,g){function a(a,c){var e=d("react-compiler-runtime").c(3),f;e[0]!==a?(f=b("ReactiveExecutorExecTimeResolverTransformer").getTransformedQueryForExecTimeMode(a),e[0]=a,e[1]=f):f=e[1];e[2]===Symbol["for"]("react.memo_cache_sentinel")?(a={fetchPolicy:"store-and-network"},e[2]=a):a=e[2];return b("react-relay/relay-hooks/useLazyLoadQuery")(f,c,a)}function c(a,c){var e=d("react-compiler-runtime").c(2),f;e[0]!==a?(f=b("ReactiveExecutorExecTimeResolverTransformer").getTransformedFragmentForExecTimeMode(a),e[0]=a,e[1]=f):f=e[1];return b("react-relay/relay-hooks/useFragment")(f,c)}g.graphql=d("relay-runtime").graphql;g.useLazyLoadClientQuery=a;g.useFragment=c}),98);
__d("LSAppendDataTraceAddon.nop",["LSAppendDataTraceAddonStoredProcedure","LSFactory","MetaConfig","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,d,e,f,g,i,j){return!c("MetaConfig")._("62")?(h||(h=b("Promise"))).resolve():c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:e,errorMessage:(d=i)!=null?d:"",syncChannel:g,tags:(a=j)!=null?a:""})};g["default"]=a}),98);
__d("LSClearCommunityMembersRangeTable",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return a[1]!==void 0?c[0]=a[1]:c[0]="",b.i64.neq(a[0],void 0)?c[1]=!1:c[1]=!0,b.forEach(b.filter(b.db.table(189).fetch(),function(d){return(c[1]||b.i64.eq(d.source,a[0]))&&d.requestId===c[0]}),function(a){return a["delete"]()})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxClearCommunityMembersRangeTableStoredProcedure";a.__tables__=["community_members_ranges_v2__generated"];e.exports=a}),null);
__d("LSClearCommunityMembersTable",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return a[1]!==void 0?c[0]=a[1]:c[0]="",b.i64.neq(a[0],void 0)?c[1]=!1:c[1]=!0,b.i64.neq(a[2],void 0)?b.forEach(b.filter(b.db.table(170).fetch(),function(d){return(c[1]||b.i64.eq(d.source,a[0]))&&b.i64.eq(d.groupThreadId,a[2])&&d.requestId===c[0]}),function(a){return a["delete"]()}):b.forEach(b.filter(b.db.table(170).fetch(),function(d){return(c[1]||b.i64.eq(d.source,a[0]))&&d.requestId===c[0]}),function(a){return a["delete"]()})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxClearCommunityMembersTableStoredProcedure";a.__tables__=["community_members"];e.exports=a}),null);
__d("LSClearCommunityMembersAndRange",["LSClearCommunityMembersRangeTable","LSClearCommunityMembersTable"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.sequence([function(d){return c.storedProcedure(b("LSClearCommunityMembersTable"),a[0],a[1],a[2])},function(d){return c.storedProcedure(b("LSClearCommunityMembersRangeTable"),a[0],a[1])}])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSMailboxClearCommunityMembersAndRangeStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSClearCommunityMembersAndRangeStoredProcedure",["LSClearCommunityMembersAndRange","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSClearCommunityMembersAndRange"),e.source,e.requestId,e.threadId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSGetAttachmentType",["LSIntEnum","MessagingAttachmentType","asyncToGeneratorRuntime","cometIsMimeTypeForMedia","genIsNonAnimatedWebPFile"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return a.type==="image/webp"?(h||(h=d("LSIntEnum"))).ofNumber((yield c("genIsNonAnimatedWebPFile")(a))?c("MessagingAttachmentType").IMAGE:c("MessagingAttachmentType").VIDEO):j(a)});return i.apply(this,arguments)}function j(a){a=a.type;if(d("cometIsMimeTypeForMedia").isMimeTypeForPhoto(a))return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE);else if(a==="audio/wav")return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO);else if(a==="image/gif")return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE);else if(d("cometIsMimeTypeForMedia").isMimeTypeForVideo(a))return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO);else return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").FILE)}g.LSGetAttachmentType=a;g.LSGetAttachmentTypeSyncButLessAccurate=j}),98);
__d("LSGetMessageAttributionParams",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.filter(b.db.table(31).fetch(),function(b){return b.offlineThreadingId===a[0]}).next().then(function(a,b){var d=a.done;a=a.value;return d?(d=[void 0,void 0,void 0],c[0]=d[0],c[1]=d[1],c[2]=d[2],d):(b=a.item,d=[b.threadAttributionSource,b.platformRef,b.platformToken],c[0]=d[0],c[1]=d[1],c[2]=d[2],d)})},function(a){return a=[c[0],c[1],c[2]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMediaSendGetMessageAttributionParamsStoredProcedure";a.__tables__=["messages_optimistic_context"];e.exports=a}),null);
__d("LSInsertPhase2PendingTask",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(12).fetch([[[a[0]]],"optimistic"]).next().then(function(a,b){var d=a.done;a=a.value;return d?c[0]=void 0:(b=a.item,c[0]=b.threadKey)})},function(d){return b.i64.neq(c[0],void 0)?b.sequence([function(d){return c[3]=b.i64.of_float(Date.now()),b.db.table(2).add({taskId:void 0,taskValue:a[0],queueName:[b.i64.to_string(c[0]),"_multi_media"].join(""),context:"4",enqueueTimestampMs:c[3],pluginType:a[1]})},function(a){return c[2]=void 0}]):b.resolve(c[2]=b.i64.cast([0,1002]))},function(a){return d[0]=c[2]}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMediaSendInsertPhase2PendingTaskStoredProcedure";a.__tables__=["messages","pending_tasks"];e.exports=a}),null);
__d("LSUpsertCommunityMemberRanges",["LSArrayGetObjectAt"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.createArray(),d[3]=(d[0].push(c.i64.cast([0,0])),d[0]),a[2]===!0?c.resolve(d[1]=!0):c.sequence([function(e){return d[3]=!1,d[4]=c.i64.of_int32(a[1].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(e){return d[5]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[1],d[5]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(a){return d[3]=d[3]||c.i64.eq(c.i64.cast([0,1]),d[6])}])}):c.resolve()},function(a){return d[1]=d[3]}])},function(b){return a[9]!==void 0?d[2]=a[9]:d[2]="",c.db.table(189).put({communityId:a[0],isAdmin:d[1],minName:"",source:a[7],requestId:d[2],maxName:a[6],isLoadingBefore:!1,isLoadingAfter:a[4],hasMoreBefore:!1,hasMoreAfter:a[3],nextPageCursor:a[5]})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpsertCommunityMemberRangesStoredProcedure";a.__tables__=["community_members_ranges_v2__generated"];e.exports=a}),null);
__d("LSIssueCommunityMemberListFetch",["LSIssueNewTask","LSUpsertCommunityMemberRanges"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.createArray(),d[4]=(d[0].push(c.i64.cast([0,0])),d[0]),d[1]=c.createArray(),c.storedProcedure(b("LSUpsertCommunityMemberRanges"),a[0],a[1],a[2],!1,!0,"",a[5],a[6],a[9],a[11])},function(e){return d[2]=new c.Map(),d[2].set("community_id",a[0]),d[2].set("roles",a[1]),d[2].set("fetch_admins_only",a[2]),d[2].set("cursor",a[4]),d[2].set("source",a[6]),d[2].set("thread_key",a[7]),d[2].set("search_text",a[8]),d[2].set("thread_roles",a[9]),d[2].set("group_thread_id",a[10]),d[2].set("request_id",a[11]),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),"fetch_community_member_list",c.i64.cast([0,355]),d[3],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxIssueCommunityMemberListFetchStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIssueCommunityMemberListFetchStoredProcedure",["LSIssueCommunityMemberListFetch","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueCommunityMemberListFetch"),e.communityId,e.roles,e.fetchAdminsOnly,e.fetchFriendMembersOnly,e.nextPageCursor,e.maxName,e.source,e.threadKey,e.searchText,e.threadRoles,e.groupThreadId,e.requestId,e.maxTimestampMs);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSIssueSendAttachmentMessageTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSPredefineTraceForTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_int32(a[5].length),c.i64.gt(d[0],c.i64.cast([0,0]))?c.loopAsync(d[0],function(e){return d[7]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[5],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(b){return c.forEach(c.filter(c.db.table(16).fetch([[[a[1],a[3]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&b.messageId===a[3]&&c.i64.eq(b.attachmentIndex,d[7])&&c.i64.eq(b.authorityLevel,c.i64.cast([0,20]))}),function(a){var b=a.update;a.item;return b({attachmentFbid:c.i64.to_string(d[8])})})}])}):c.resolve()},function(b){return c.i64.eq(void 0,c.i64.cast([0,12]))?d[1]=c.i64.cast([0,10]):(a[9]?d[7]=c.i64.cast([0,9]):d[7]=c.i64.cast([0,3]),d[1]=d[7]),c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[2]=c.i64.cast([0,1]):(b=a.item,d[8]=b.syncGroup,c.i64.neq(d[8],void 0)?d[7]=d[8]:d[7]=c.i64.cast([0,1]),d[2]=d[7])})},function(e){return c.storedProcedure(b("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),c.i64.to_string(a[1]),c.i64.cast([0,46]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),d[2],void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[4]=a[0],a})},function(e){return a[12]!==void 0?c.sequence([function(e){return c.storedProcedure(b("LSPredefineTraceForTask"),a[12],d[4],c.i64.to_string(c.i64.cast([0,46])),a[3])},function(d){return c.storedProcedure(b("LSAppendDataTraceAddon"),a[12],c.i64.cast([0,20]),c.i64.cast([0,1]),void 0,void 0)}]):c.resolve()},function(b){return d[5]=new c.Map(),d[6]=c.createArray(),c.db.table(31).add({taskId:d[4],threadKey:a[1],offlineThreadingId:a[3],threadAttributionSource:a[6],platformRef:a[10],platformToken:a[11],replySourceId:a[7],replySourceType:a[8],sendType:d[1],markThreadRead:!1})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxIssueSendAttachmentMessageTaskStoredProcedure";a.__tables__=["attachments","threads","messages_optimistic_context"];e.exports=a}),null);
__d("LSLocalApplyOptimisticMessageV2",["LSCreateOfflineThreadingID","LSGetLocalizedReplySnippet","LSIssueNewError","LSSetMessageDisplayedContentTypes","LSSetMessageViewFlags"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSCreateOfflineThreadingID"),d[0]).then(function(a){return a=a,d[1]=a[0],a})},function(e){return d[4]=c.i64.to_string(d[1]),d[3]=a[4]==null?a[3]:a[4],c.sequence([function(b){return d[5]=a[5].get("snippet_has_emoji"),c.islc(c.db.table(9).fetchDesc([[[]],"lastActivityTimestampMs"]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?d[6]=c.i64.cast([-1,4294967295]):(b=a.item,d[6]=b.lastActivityTimestampMs)})},function(e){return d[8]=c.i64.add(d[6],c.i64.cast([0,1])),d[10]=c.i64.gt(d[0],d[8])?d[0]:d[8],c.db.table(9).fetch([[[a[1]]]]).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(b){return function(a){c.logger(a).info(a)}("localApplyOptimisticMessage insert optimistic thread"),c.i64.eq(a[2],c.i64.cast([0,1]))?c.sequence([function(b){return c.filter(c.db.table(7).fetch([[[a[1]]]]),function(b){return c.i64.eq(b.id,a[1])&&c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))}).next().then(function(a,b){var e=a.done;a=a.value;return e?d[16]=!1:(b=a.item,d[19]=b.capabilities2,c.i64.neq(d[19],void 0)?d[18]=d[19]:d[18]=c.i64.cast([0,0]),d[16]=c.i64.neq(c.i64.and_(d[18],c.i64.cast([0,4096])),c.i64.cast([0,0])))})},function(a){return d[11]=d[16]}]):c.resolve(d[11]=!1)},function(b){return d[11]?d[12]="e2ee_cutover":d[12]="inbox",d[11]?d[13]=c.i64.cast([-1,4294967279]):d[13]=c.i64.cast([0,0]),c.forEach(c.filter(c.db.table(9).fetch([[[a[1]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&c.i64.lt(b.authorityLevel,c.i64.cast([0,40]))}),function(a){return a["delete"]()})},function(b){return c.db.table(9).add({threadKey:a[1],mailboxType:c.i64.cast([0,0]),threadType:a[2],clientThreadKey:a[1],folderName:d[12],parentThreadKey:d[13],lastActivityTimestampMs:d[10],lastReadWatermarkTimestampMs:d[10],snippet:d[3],snippetHasEmoji:d[5]==null?!1:d[5],snippetSenderContactId:a[0],ongoingCallState:c.i64.cast([0,0]),authorityLevel:c.i64.cast([0,40])})},function(b){return c.i64.eq(a[2],c.i64.cast([0,13]))||c.i64.eq(a[2],c.i64.cast([0,7]))||c.i64.eq(a[2],c.i64.cast([0,1]))?c.sequence([function(b){return c.forEach(c.filter(c.db.table(14).fetch([[[a[1],a[1]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&c.i64.eq(b.contactId,a[1])&&c.i64.lt(b.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(b){return c.db.table(14).add({threadKey:a[1],contactId:a[1],readWatermarkTimestampMs:c.i64.cast([0,0]),deliveredWatermarkTimestampMs:c.i64.cast([0,0]),authorityLevel:c.i64.cast([0,20]),isModerator:!1})}]):c.resolve()},function(a){return c.sortBy(c.db.table(115).fetch(),[["timestampMs","DESC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[14]=!1:(b=a.item,d[14]=b.errorShouldBeShown)})},function(a){return d[14]===!0?c.sequence([function(a){return c.localizeV2Async(c.i64.cast([0,2285622730]),void 0).then(function(a){return d[16]=a})},function(a){return c.localizeV2Async(c.i64.cast([0,1919524925]),void 0).then(function(a){return d[17]=a})},function(a){return c.storedProcedure(b("LSIssueNewError"),void 0,c.i64.cast([0,1545093]),d[16],d[17],void 0,void 0)}]):c.resolve()}]):(e.item,c.forEach(c.filter(c.db.table(9).fetch([[[a[1]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&c.i64.eq(b.threadType,a[2])}),function(b){var c=b.update;b.item;return c({lastActivityTimestampMs:d[10],lastReadWatermarkTimestampMs:d[10],snippet:d[3],snippetHasEmoji:d[5]==null?!1:d[5],snippetSenderContactId:a[0],snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0,additionalThreadContext:void 0})}))})}])},function(e){return c.sequence([function(b){return c.islc(c.db.table(12).fetchDesc([[[a[1],c.i64.cast([0,80])],[a[1],c.i64.cast([0,60])],[a[1],c.i64.cast([0,40])]],"messageDisplayOrderAuthority"]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[56]=c.i64.of_float(Date.now()),d[5]=d[56]):(b=a.item,d[5]=b.primarySortKey)})},function(e){return d[7]=a[5].get("reply_source_id"),d[8]=a[5].get("reply_source_type"),d[9]=a[5].get("reply_source_type_v2"),d[10]=a[5].get("reply_type"),d[7]!==void 0&&(c.i64.eq(d[8],c.i64.cast([0,1]))||c.i64.eq(d[9],c.i64.cast([0,1])))?c.sequence([function(e){return c.filter(c.db.table(12).fetch([[[d[7]==null?"":d[7]]],"messageId"]),function(b){return c.i64.eq(b.threadKey,a[1])&&b.messageId===(d[7]==null?"":d[7])}).next().then(function(e,f){var g=e.done;e=e.value;return g?(g=[d[7],void 0,void 0,c.i64.cast([0,0]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],d[56]=g[0],d[57]=g[1],d[58]=g[2],d[59]=g[3],d[60]=g[4],d[61]=g[5],d[62]=g[6],d[63]=g[7],d[64]=g[8],d[65]=g[9],d[66]=g[10],d[67]=g[11],d[68]=g[12],d[69]=g[13],d[70]=g[14],d[71]=g[15],g):(f=e.item,c.sequence([function(e){return d[77]=f.senderId,d[76]=f.stickerId,c.i64.neq(d[76],void 0)?(e=[d[76],c.i64.cast([0,4])],d[78]=e[0],d[79]=e[1],e):(e=[void 0,void 0],d[78]=e[0],d[79]=e[1],e),e=[d[78],d[79]],d[73]=e[0],d[74]=e[1],e,c.sequence([function(e){return c.storedProcedure(b("LSGetLocalizedReplySnippet"),a[1],a[0],d[77],d[10]==null?c.i64.cast([0,0]):d[10]).then(function(a){return a=a,d[78]=a[0],a})},function(a){return d[75]=c.i64.eq(d[9],c.i64.cast([0,1]))?d[78]:""}])},function(a){return a=[d[7],d[8],d[9],c.i64.cast([0,1]),d[75],d[77],f.text,d[73],d[74],void 0,void 0,void 0,void 0,void 0,void 0,d[10]],d[56]=a[0],d[57]=a[1],d[58]=a[2],d[59]=a[3],d[60]=a[4],d[61]=a[5],d[62]=a[6],d[63]=a[7],d[64]=a[8],d[65]=a[9],d[66]=a[10],d[67]=a[11],d[68]=a[12],d[69]=a[13],d[70]=a[14],d[71]=a[15],a}]))})},function(a){return a=[d[56],d[57],d[58],d[59],d[60],d[61],d[62],d[63],d[64],d[65],d[66],d[67],d[68],d[69],d[70],d[71]],d[11]=a[0],d[12]=a[1],d[13]=a[2],d[14]=a[3],d[15]=a[4],d[16]=a[5],d[17]=a[6],d[18]=a[7],d[19]=a[8],d[20]=a[9],d[21]=a[10],d[22]=a[11],d[23]=a[12],d[24]=a[13],d[25]=a[14],d[26]=a[15],a}]):c.resolve((d[7]===void 0||c.i64.eq(d[8],c.i64.cast([0,0]))||c.i64.eq(d[9],c.i64.cast([0,0]))?(e=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],d[56]=e[0],d[57]=e[1],d[58]=e[2],d[59]=e[3],d[60]=e[4],d[61]=e[5],d[62]=e[6],d[63]=e[7],d[64]=e[8],d[65]=e[9],d[66]=e[10],d[67]=e[11],d[68]=e[12],d[69]=e[13],d[70]=e[14],d[71]=e[15],e):(e=[d[7],d[8],d[9],c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],d[56]=e[0],d[57]=e[1],d[58]=e[2],d[59]=e[3],d[60]=e[4],d[61]=e[5],d[62]=e[6],d[63]=e[7],d[64]=e[8],d[65]=e[9],d[66]=e[10],d[67]=e[11],d[68]=e[12],d[69]=e[13],d[70]=e[14],d[71]=e[15],e),e=[d[56],d[57],d[58],d[59],d[60],d[61],d[62],d[63],d[64],d[65],d[66],d[67],d[68],d[69],d[70],d[71]],d[11]=e[0],d[12]=e[1],d[13]=e[2],d[14]=e[3],d[15]=e[4],d[16]=e[5],d[17]=e[6],d[18]=e[7],d[19]=e[8],d[20]=e[9],d[21]=e[10],d[22]=e[11],d[23]=e[12],d[24]=e[13],d[25]=e[14],d[26]=e[15],e))},function(b){return d[27]=a[5].get("mention_data"),d[27]?d[28]=!1:d[28]=!0,d[28]?(b=[void 0,void 0,void 0,void 0],d[29]=b[0],d[30]=b[1],d[31]=b[2],d[32]=b[3],b):(d[56]=d[27].get("mention_offsets"),d[57]=d[27].get("mention_lengths"),d[58]=d[27].get("mention_ids"),d[59]=d[27].get("mention_types"),b=[d[56],d[57],d[58],d[59]],d[29]=b[0],d[30]=b[1],d[31]=b[2],d[32]=b[3],b),d[33]=a[5].get("magic_words_data"),d[33]?d[34]=!1:d[34]=!0,d[34]?(b=[void 0,void 0],d[35]=b[0],d[36]=b[1],b):(d[56]=d[33].get("magic_word_offsets"),d[57]=d[33].get("magic_word_lengths"),b=[d[56],d[57]],d[35]=b[0],d[36]=b[1],b),d[55]=c.i64.eq(d[10],c.i64.cast([0,1]))?d[17]:a[3],d[37]=a[5].get("sticker_id"),d[38]=a[5].get("sticker_alt_text"),d[39]=a[5].get("hot_emoji_size"),d[40]=a[5].get("iout"),d[41]=a[5].get("platform_XMD_encoded"),d[42]=a[5].get("is_forwarded"),d[43]=a[5].get("forward_score"),d[44]=a[5].get("power_up_style"),d[45]=a[5].get("local_data_id"),d[46]=a[5].get("command_type"),d[47]=a[5].get("reply_type"),d[48]=a[5].get("rich_text_format_type"),c.i64.eq(d[48],c.i64.cast([0,1]))?d[49]=c.i64.cast([0,3]):d[49]=c.i64.cast([0,0]),d[50]=a[5].get("ephemeral_duration_in_sec"),d[51]=a[5].get("is_forwarded"),d[51]?d[52]=c.i64.cast([0,3]):d[52]=d[13],d[53]=a[5].get("plugin_type"),c.i64.eq(d[53],c.i64.cast([0,40]))?d[54]="Instamadillo":d[54]="FBBroker",c.i64.eq(c.i64.cast([0,20]),c.i64.cast([0,20]))?c.db.table(12).add({threadKey:a[1],messageId:d[4],timestampMs:d[0],offlineThreadingId:d[4],primarySortKey:d[5],secondarySortKey:d[0],text:d[55],senderId:a[0],stickerId:d[37],hotEmojiSize:d[39],platformXmdEncoded:d[41],isForwarded:d[42],forwardScore:d[43],isAdminMessage:!1,sendStatus:c.i64.cast([0,1]),sendStatusV2:c.i64.cast([0,1]),authorityLevel:c.i64.cast([0,20]),localDataId:d[45],replyType:d[26],messageRenderingType:d[49],ephemeralDurationInSec:d[50],metadataDataclass:a[6],replySourceId:d[11],replySourceType:d[12],replySourceTypeV2:d[52],replyStatus:d[14],replySnippet:d[15],replyToUserId:d[16],replyMessageText:d[17],replyAttachmentId:d[18],replyAttachmentType:d[19],replyMediaUrl:d[20],replyMediaUrlFallback:d[21],replyMediaPreviewWidth:d[22],replyMediaPreviewHeight:d[23],replyMediaUrlMimeType:d[24],mentionOffsets:d[29],mentionLengths:d[30],mentionIds:d[31],mentionTypes:d[32],transportKey:d[54]}):c.sequence([function(a){return c.db.table(12).fetch([[[d[4]]],"optimistic"]).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[d[5],d[0],d[45]],d[56]=c[0],d[57]=c[1],d[58]=c[2],c):(b=a.item,c=[b.primarySortKey,b.secondarySortKey,b.localDataId],d[56]=c[0],d[57]=c[1],d[58]=c[2],c)})},function(a){return c.forEach(c.filter(c.db.table(12).fetch([[[d[4]]],"optimistic"]),function(a){return a.offlineThreadingId===d[4]&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(b){return c.db.table(12).add({threadKey:a[1],messageId:d[4],timestampMs:d[0],offlineThreadingId:d[4],primarySortKey:d[56],secondarySortKey:d[57],text:d[55],senderId:a[0],stickerId:d[37],hotEmojiSize:d[39],platformXmdEncoded:d[41],isForwarded:d[42],forwardScore:d[43],isAdminMessage:!1,sendStatus:c.i64.cast([0,1]),sendStatusV2:c.i64.cast([0,1]),authorityLevel:c.i64.cast([0,20]),localDataId:d[58],replyType:d[26],messageRenderingType:d[49],ephemeralDurationInSec:d[50],metadataDataclass:a[6],replySourceId:d[11],replySourceType:d[12],replySourceTypeV2:d[52],replyStatus:d[14],replySnippet:d[15],replyToUserId:d[16],replyMessageText:d[17],replyAttachmentId:d[18],replyAttachmentType:d[19],replyMediaUrl:d[20],replyMediaUrlFallback:d[21],replyMediaPreviewWidth:d[22],replyMediaPreviewHeight:d[23],replyMediaUrlMimeType:d[24],mentionOffsets:d[29],mentionLengths:d[30],mentionIds:d[31],mentionTypes:d[32],transportKey:d[54]})}])}])},function(e){return d[5]=c.createArray(),d[6]=(d[5].push("LSMailboxLocalApplyOptimisticMessageV2StoredProcedure"),d[5]),d[7]=(d[5].push("localApplyOptimisticMessage"),d[5]),d[8]=(d[5].push(a[1]),d[5]),d[9]=(d[5].push(d[4]),d[5]),d[10]=c.toJSON(d[5]),function(a){c.logger(a).info(a)}(d[10]),d[2]=a[5].get("calculate_denormalizations"),(d[2]==null?!0:d[2])?c.sequence([function(e){return c.storedProcedure(b("LSSetMessageViewFlags"),a[1],d[4],d[0],c.i64.eq(a[2],c.i64.cast([0,1])))},function(e){return d[5]=a[5].get("sticker_id"),c.storedProcedure(b("LSSetMessageDisplayedContentTypes"),a[1],d[4],d[0],a[3],!1,c.i64.neq(d[5],void 0))}]):c.resolve()},function(a){return a=[d[4],d[0]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxLocalApplyOptimisticMessageV2StoredProcedure";a.__tables__=["threads","contacts","participants","user_visible_network_connectivity_error","messages"];e.exports=a}),null);
__d("LSMarkSubJobCompletedV2",["LSArrayGetObjectAt"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return d[0]=c.createArray(),c.db.table(51).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?0:(b=a.item,d[3]=new c.Map(),d[3].set("offline_attachment_id",b.offlineAttachmentId),d[3].set("offline_threading_id",b.offlineThreadingId),d[3].set("in_message_index",b.inMessageIndex),d[3].set("attachment_type",b.attachmentType),d[3].set("should_transcode",b.shouldTranscode),d[3].set("use_double_phase",b.useDoublePhase),d[3].set("send_by_server",b.sendByServer),d[3].set("is_secure",b.isSecure),d[3].set("state",b.state),d[3].set("fbid",b.fbid),d[3].set("metadata",b.metadata),d[3].set("error",b.error),d[3].set("message_id",b.messageId),d[4]=(d[0].push(d[3]),d[0]))})},function(e){return d[2]=c.i64.of_int32(d[0].length),c.i64.neq(d[2],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[0],c.i64.cast([0,0])).then(function(a){return a=a,d[3]=a[0],d[4]=a[1],a})},function(b){return d[5]=d[3].get("state"),c.i64.neq(a[1],void 0)?a[2]!==void 0?(c.i64.eq(d[5],c.i64.cast([-1,4294967293]))?(d[7]=c.i64.cast([-1,4294967295]),d[6]=d[7]):(c.i64.eq(d[5],c.i64.cast([0,1]))?d[7]=c.i64.cast([0,2]):(c.i64.eq(d[5],c.i64.cast([0,3]))?d[8]=c.i64.cast([0,4]):(c.i64.eq(d[5],c.i64.cast([0,5]))?d[9]=c.i64.cast([0,6]):(c.i64.eq(d[5],c.i64.cast([0,13]))?d[10]=c.i64.cast([0,14]):(c.i64.eq(d[5],c.i64.cast([0,7]))?d[11]=c.i64.cast([0,8]):(c.i64.eq(d[5],c.i64.cast([0,9]))?d[12]=c.i64.cast([0,10]):(c.i64.eq(d[5],c.i64.cast([0,11]))?d[13]=c.i64.cast([0,12]):d[13]=d[5],d[12]=d[13]),d[11]=d[12]),d[10]=d[11]),d[9]=d[10]),d[8]=d[9]),d[7]=d[8]),d[6]=d[7]),c.forEach(c.db.table(51).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({state:d[6],fbid:a[1],messageId:a[2],metadata:a[3]})})):(c.i64.eq(d[5],c.i64.cast([-1,4294967293]))?(d[7]=c.i64.cast([-1,4294967295]),d[6]=d[7]):(c.i64.eq(d[5],c.i64.cast([0,1]))?d[7]=c.i64.cast([0,2]):(c.i64.eq(d[5],c.i64.cast([0,3]))?d[8]=c.i64.cast([0,4]):(c.i64.eq(d[5],c.i64.cast([0,5]))?d[9]=c.i64.cast([0,6]):(c.i64.eq(d[5],c.i64.cast([0,13]))?d[10]=c.i64.cast([0,14]):(c.i64.eq(d[5],c.i64.cast([0,7]))?d[11]=c.i64.cast([0,8]):(c.i64.eq(d[5],c.i64.cast([0,9]))?d[12]=c.i64.cast([0,10]):(c.i64.eq(d[5],c.i64.cast([0,11]))?d[13]=c.i64.cast([0,12]):d[13]=d[5],d[12]=d[13]),d[11]=d[12]),d[10]=d[11]),d[9]=d[10]),d[8]=d[9]),d[7]=d[8]),d[6]=d[7]),c.forEach(c.db.table(51).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({state:d[6],fbid:a[1],metadata:a[3]})})):c.i64.neq(a[4],void 0)?(c.i64.eq(d[5],c.i64.cast([-1,4294967293]))?(d[7]=c.i64.cast([-1,4294967295]),d[6]=d[7]):(c.i64.eq(d[5],c.i64.cast([0,1]))?d[7]=c.i64.cast([0,2]):(c.i64.eq(d[5],c.i64.cast([0,3]))?d[8]=c.i64.cast([0,4]):(c.i64.eq(d[5],c.i64.cast([0,5]))?d[9]=c.i64.cast([0,6]):(c.i64.eq(d[5],c.i64.cast([0,13]))?d[10]=c.i64.cast([0,14]):(c.i64.eq(d[5],c.i64.cast([0,7]))?d[11]=c.i64.cast([0,8]):(c.i64.eq(d[5],c.i64.cast([0,9]))?d[12]=c.i64.cast([0,10]):(c.i64.eq(d[5],c.i64.cast([0,11]))?d[13]=c.i64.cast([0,12]):d[13]=d[5],d[12]=d[13]),d[11]=d[12]),d[10]=d[11]),d[9]=d[10]),d[8]=d[9]),d[7]=d[8]),d[6]=d[7]),c.forEach(c.db.table(51).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({state:d[6],error:a[4]})})):(c.i64.eq(d[5],c.i64.cast([-1,4294967293]))?(d[7]=c.i64.cast([-1,4294967295]),d[6]=d[7]):(c.i64.eq(d[5],c.i64.cast([0,1]))?d[7]=c.i64.cast([0,2]):(c.i64.eq(d[5],c.i64.cast([0,3]))?d[8]=c.i64.cast([0,4]):(c.i64.eq(d[5],c.i64.cast([0,5]))?d[9]=c.i64.cast([0,6]):(c.i64.eq(d[5],c.i64.cast([0,13]))?d[10]=c.i64.cast([0,14]):(c.i64.eq(d[5],c.i64.cast([0,7]))?d[11]=c.i64.cast([0,8]):(c.i64.eq(d[5],c.i64.cast([0,9]))?d[12]=c.i64.cast([0,10]):(c.i64.eq(d[5],c.i64.cast([0,11]))?d[13]=c.i64.cast([0,12]):d[13]=d[5],d[12]=d[13]),d[11]=d[12]),d[10]=d[11]),d[9]=d[10]),d[8]=d[9]),d[7]=d[8]),d[6]=d[7]),c.forEach(c.db.table(51).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({state:d[6]})}))}]):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMediaSendMarkSubJobCompletedV2StoredProcedure";a.__tables__=["media_send_jobs"];e.exports=a}),null);
__d("LSMarkSubJobCompletedV2StoredProcedure",["LSMarkSubJobCompletedV2","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSMarkSubJobCompletedV2"),e.offlineAttachmentId,e.fbid,e.messageId,e.metadata,e.error);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSMessageReplySourceType",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,MESSAGE:1,STORY:2,FORWARD:3,FB_STORY_SHARE:4,IG_STORY_SHARE:5,LIGHTWEIGHT_STATUS:6,LIGHTWEIGHT_STATUS_REACTION:7,FB_FEED_POST:13,HIGHLIGHTS_TAB_POST_REPLY:14,HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:15,SHARED_ALBUM:16,AVATAR_DETAIL:17,NOTE_REPLY_ARMADILLO:18,HIGHLIGHTS_TAB_CARDS_FOR_MOM:19,HIGHLIGHTS_TAB_CARDS_FOR_BIRTHDAY:20,NOTE_MENTION:21});f["default"]=a}),66);
__d("LSMessageSendToSentQPLInteractionHelper.nop",["Promise","QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,d,e,f){f!=null&&c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),e,{instanceKey:parseInt(f,10)});return(h||(h=b("Promise"))).resolve()}g["default"]=a}),98);
__d("LSUpdateOptimisticAttachmentPreview",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(16).fetch([[[a[0],a[1],a[2]]]]),function(c){return c.attachmentFbid===a[2]&&b.i64.eq(c.threadKey,a[0])&&c.messageId===a[1]&&b.i64.eq(c.authorityLevel,b.i64.cast([0,20]))}),function(b){var c=b.update;b.item;return c({playableUrl:a[3],playableUrlFallback:a[4],playableUrlExpirationTimestampMs:a[5],playableUrlMimeType:a[6],previewUrl:a[7],previewUrlFallback:a[8],previewUrlExpirationTimestampMs:a[9],previewUrlMimeType:a[10],previewWidth:a[11],previewHeight:a[12],imageUrl:void 0,imageUrlFallback:void 0,imageUrlExpirationTimestampMs:void 0,imageUrlMimeType:void 0})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateOptimisticAttachmentPreviewStoredProcedure";a.__tables__=["attachments"];e.exports=a}),null);
__d("LSOptimisticSendAttachmentForward",["LSInsertOptimisticAttachment","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessage","LSUpdateOptimisticAttachmentPreview"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[1]=a[3]===""?void 0:a[3],d[1]!==void 0?c.sequence([function(b){return c.forEach(c.filter(c.db.table(16).fetch([[[a[1],d[1]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&b.messageId===d[1]&&c.i64.eq(b.authorityLevel,c.i64.cast([0,20]))}),function(b){var d=b.update;b.item;return d({attachmentFbid:c.i64.to_string(a[7])})})},function(a){return d[0]=d[1]}]):c.sequence([function(e){return c.storedProcedure(b("LSLocalApplyOptimisticMessage"),a[0],a[1],a[2],a[4],a[5],a[6],void 0,void 0,void 0,void 0,c.i64.cast([0,3]),void 0,void 0,void 0,!0).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return c.filter(c.db.table(16).fetch(),function(b){return b.attachmentFbid===c.i64.to_string(a[7])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.storedProcedure(b("LSInsertOptimisticAttachment"),a[1],d[3],d[2],d[2],c.i64.to_string(a[7]),c.i64.cast([0,2]),void 0,void 0,!0,!1):(f=e.item,c.sequence([function(e){return c.storedProcedure(b("LSInsertOptimisticAttachment"),a[1],d[3],d[2],d[2],c.i64.to_string(a[7]),f.attachmentType,f.filename,f.attributionAppId,!0,!1)},function(e){return c.storedProcedure(b("LSUpdateOptimisticAttachmentPreview"),a[1],d[2],c.i64.to_string(a[7]),f.playableUrl,f.playableUrlFallback,f.playableUrlExpirationTimestampMs,f.playableUrlMimeType,f.previewUrl,f.previewUrlFallback,f.previewUrlExpirationTimestampMs,f.previewUrlMimeType,f.previewWidth,f.previewHeight)}]))})},function(a){return d[0]=d[2]}])},function(e){return c.sequence([function(b){return d[2]=c.createArray(),d[6]=(d[2].push(a[7]),d[2]),c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[3]=c.i64.cast([0,1]):(b=a.item,d[7]=b.syncGroup,c.i64.neq(d[7],void 0)?d[6]=d[7]:d[6]=c.i64.cast([0,1]),d[3]=d[6])})},function(e){return c.storedProcedure(b("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),c.i64.to_string(a[1]),c.i64.cast([0,46]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),d[3],void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[5]=a[0],a})},function(b){return c.db.table(31).add({taskId:d[5],threadKey:a[1],offlineThreadingId:d[0],threadAttributionSource:a[8],sendType:c.i64.cast([0,4]),markThreadRead:!1,initiatingSource:a[9]})}])},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxOptimisticSendAttachmentForwardStoredProcedure";a.__tables__=["attachments","threads","messages_optimistic_context"];e.exports=a}),null);
__d("LSOptimisticSendAttachmentForwardStoredProcedure",["LSOptimisticSendAttachmentForward","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOptimisticSendAttachmentForward"),e.senderId,e.threadKey,e.threadType,e.offlineThreadingId,e.text,e.snippet,e.snippetHasEmoji,e.forwardedAttachmentFbid,e.source,e.initiatingSource);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSOptimisticSendMessageForward",["LSInsertOptimisticAttachment","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessage","LSPredefineTraceForTask","LSUpdateOptimisticAttachmentPreview","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return d.filter(d.db.table(12).fetch([[[a[3],a[4],a[5]]]]),function(b){return d.i64.eq(b.threadKey,a[3])&&d.i64.eq(d.i64.cast([0,0]),d.i64.cast([0,0]))&&d.i64.eq(b.timestampMs,a[4])&&b.messageId===a[5]&&d.i64.eq(b.authorityLevel,d.i64.cast([0,80]))}).next().then(function(f,g){var h=f.done;f=f.value;return h?(e[3]=d.createArray(),e[4]=(e[3].push("optimisticSendMessageForward msg not found"),e[3]),e[5]=(e[3].push(a[5]),e[3]),e[6]=d.toJSON(e[3]),function(a){d.logger(a).mustfix(a)}(e[6]),h=["",d.i64.cast([-1,4294967295])],e[0]=h[0],e[1]=h[1],h):(g=f.item,d.sequence([function(f){return e[11]=g.forwardScore,e[3]=g.text,c("gkx")("24141")?(d.i64.neq(e[11],void 0)?e[12]=d.i64.lt(e[11],d.i64.cast([0,127])):e[12]=!0,d.i64.eq(a[0],g.senderId)||!e[12]?e[13]=e[11]:(d.i64.neq(e[11],void 0)?e[14]=d.i64.add(e[11],d.i64.cast([0,1])):e[14]=d.i64.cast([0,1]),e[13]=e[14]),e[4]=e[13]):e[4]=e[11],d.storedProcedure(b("LSLocalApplyOptimisticMessage"),a[0],a[1],a[2],e[3],void 0,void 0,g.stickerId,g.hotEmojiSize,void 0,void 0,d.i64.cast([0,3]),void 0,e[4],void 0,!0).then(function(a){return a=a,e[5]=a[0],e[6]=a[1],a})},function(c){return d.forEach(d.db.table(16).fetch([[[g.threadKey,g.messageId]]]),function(c){var f=c.item;return d.sequence([function(c){return e[16]=f.attachmentFbid,e[12]=d.createArray(),e[13]=(e[12].push(e[16]),e[12]),e[14]=(e[12].push(e[5]),e[12]),e[15]=d.toJSON(e[12]),d.storedProcedure(b("LSInsertOptimisticAttachment"),a[1],e[6],e[5],e[16],e[15],f.attachmentType,f.filename,void 0,f.hasMedia,f.hasXma)},function(c){return d.storedProcedure(b("LSUpdateOptimisticAttachmentPreview"),a[1],e[5],e[15],f.playableUrl,f.playableUrlFallback,f.playableUrlExpirationTimestampMs,f.playableUrlMimeType,f.previewUrl,f.previewUrlFallback,f.previewUrlExpirationTimestampMs,f.previewUrlMimeType,f.previewWidth,f.previewHeight)}])})},function(b){return d.db.table(9).fetch([[[a[1]]]]).next().then(function(b,c){var a=b.done;b=b.value;return a?e[7]=d.i64.cast([0,1]):(c=b.item,e[13]=c.syncGroup,d.i64.neq(e[13],void 0)?e[12]=e[13]:e[12]=d.i64.cast([0,1]),e[7]=e[12])})},function(c){return d.storedProcedure(b("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),d.i64.to_string(a[1]),d.i64.cast([0,46]),"",void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),e[7],void 0,d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[9]=a[0],a})},function(a){return void 0!==void 0?d.storedProcedure(b("LSPredefineTraceForTask"),void 0,e[9],d.i64.to_string(d.i64.cast([0,46])),e[5]):d.resolve()},function(b){return d.db.table(31).add({taskId:e[9],threadKey:a[1],offlineThreadingId:e[5],messageId:a[5],threadAttributionSource:a[6],sendType:d.i64.cast([0,5]),markThreadRead:!1,initiatingSource:a[7]})},function(b){return e[12]=new d.Map(),e[13]=e[12].set("optimisticSendMessageForward",a[1]),e[14]=e[12].set("fwdMsgID",a[5]),e[15]=d.toJSON(e[12]),e[10]=e[15],function(a){d.logger(a).info(a)}(e[10]),b=[e[5],e[9]],e[0]=b[0],e[1]=b[1],b}]))})},function(a){return f[0]=e[0]}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSMailboxOptimisticSendMessageForwardStoredProcedure";a.__tables__=["messages","attachments","threads","messages_optimistic_context"];d=a;g["default"]=d}),98);
__d("LSOptimisticSendMessageForwardStoredProcedure",["LSOptimisticSendMessageForward","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOptimisticSendMessageForward"),e.senderId,e.threadKey,e.threadType,e.forwardedMsgThreadKey,e.forwardedMsgTimestampMs,e.forwardedMsgId,e.source,e.initiatingSource);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSOptimisticSendMessageV2",["LSAppendDataTraceAddon.nop","LSInsertOptimisticAttachment","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessageV2","LSLogEventAnnotate.nop","LSMessageSendToSentQPLInteractionHelper.nop","LSOptimisticMarkThreadReadV2","LSPredefineTraceForTask","LSUpdateOptimisticAttachmentPreview","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(c){return e[0]=a[6].get("qpl_instance_key"),d.storedProcedure(b("LSLocalApplyOptimisticMessageV2"),a[0],a[1],a[2],a[4],a[5],a[6],void 0).then(function(a){return a=a,e[1]=a[0],e[2]=a[1],a})},function(f){return d.sequence([function(c){return e[5]=a[6].get("external_attachment_url"),e[39]=e[5]===""?void 0:e[5],e[39]!==void 0?d.sequence([function(c){return e[40]=a[6].get("attribution_app_id"),e[41]=a[6].get("optimistic_attachment_preview"),d.nativeOperation(b("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_insert_optimistic_gif_start",e[0])},function(c){return d.storedProcedure(b("LSInsertOptimisticAttachment"),a[1],e[2],e[1],e[1],e[1],d.i64.cast([0,3]),e[39],e[40],!0,!1)},function(c){return e[41]?e[42]=!1:e[42]=!0,e[42]?d.resolve():(e[43]=e[41].get("playable_url"),e[44]=e[41].get("playable_url_fallback"),e[45]=e[41].get("playable_url_expiration_timestamp_ms"),e[46]=e[41].get("playable_url_mime_type"),e[47]=e[41].get("preview_url"),e[48]=e[41].get("preview_url_fallback"),e[49]=e[41].get("preview_url_expiration_timestamp_ms"),e[50]=e[41].get("preview_url_mime_type"),e[51]=e[41].get("preview_width"),e[52]=e[41].get("preview_height"),e[53]=e[41].get("image_url"),e[54]=e[41].get("image_url_fallback"),e[55]=e[41].get("image_url_expiration_timestamp_ms"),e[56]=e[41].get("image_url_mime_type"),d.storedProcedure(b("LSUpdateOptimisticAttachmentPreview"),a[1],e[1],e[1],e[43],e[44],e[45],e[46],e[47],e[48],e[49],e[50],e[51],e[52]))},function(a){return d.nativeOperation(b("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_insert_optimistic_gif_end",e[0])},function(a){return e[6]=d.i64.cast([0,7])}]):d.sequence([function(c){return e[40]=a[6].get("sticker_id"),d.i64.neq(e[40],void 0)?d.sequence([function(c){return d.i64.neq(e[40],d.i64.cast([53057,267535043]))&&d.i64.neq(e[40],d.i64.cast([85970,924785702]))&&d.i64.neq(e[40],d.i64.cast([85970,1004785694]))&&d.i64.neq(e[40],d.i64.cast([85970,1044785690]))?d.sequence([function(c){return e[44]=d.i64.to_string(e[40]),e[42]=a[6].get("optimistic_attachment_preview"),d.nativeOperation(b("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_insert_optimistic_sticker_start",e[0])},function(c){return d.storedProcedure(b("LSInsertOptimisticAttachment"),a[1],e[2],e[1],d.i64.to_string(e[40]),e[44],d.i64.cast([0,1]),void 0,void 0,!0,!1)},function(c){return e[42]?e[43]=!1:e[43]=!0,e[43]?d.resolve():(e[45]=e[42].get("playable_url"),e[46]=e[42].get("playable_url_fallback"),e[47]=e[42].get("playable_url_expiration_timestamp_ms"),e[48]=e[42].get("playable_url_mime_type"),e[49]=e[42].get("preview_url"),e[50]=e[42].get("preview_url_fallback"),e[51]=e[42].get("preview_url_expiration_timestamp_ms"),e[52]=e[42].get("preview_url_mime_type"),e[53]=e[42].get("preview_width"),e[54]=e[42].get("preview_height"),e[55]=e[42].get("image_url"),e[56]=e[42].get("image_url_fallback"),e[57]=e[42].get("image_url_expiration_timestamp_ms"),e[58]=e[42].get("image_url_mime_type"),d.storedProcedure(b("LSUpdateOptimisticAttachmentPreview"),a[1],e[1],e[44],e[45],e[46],e[47],e[48],e[49],e[50],e[51],e[52],e[53],e[54]))},function(a){return d.nativeOperation(b("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_insert_optimistic_sticker_end",e[0])}]):d.resolve()},function(a){return e[41]=d.i64.cast([0,2])}]):d.resolve(e[41]=d.i64.cast([0,1]))},function(a){return e[6]=e[41]}])},function(a){return d.nativeOperation(b("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_send_message_v2_task_start",e[0])},function(b){return d.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[7]=d.i64.cast([0,1]):(b=a.item,e[41]=b.syncGroup,d.i64.neq(e[41],void 0)?e[40]=e[41]:e[40]=d.i64.cast([0,1]),e[7]=e[40])})},function(c){return e[9]=a[6].get("plugin_type"),d.storedProcedure(b("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),d.i64.to_string(a[1]),d.i64.cast([0,46]),"",void 0,void 0,e[9]==null?d.i64.cast([0,0]):e[9],d.i64.cast([0,0]),e[7],void 0,d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[10]=a[0],a})},function(a){return d.nativeOperation(b("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_send_message_v2_task_end",e[0])},function(c){return e[11]=a[6].get("data_trace_id"),e[11]!==void 0?d.sequence([function(a){return d.storedProcedure(b("LSPredefineTraceForTask"),e[11],e[10],d.i64.to_string(d.i64.cast([0,46])),e[1])},function(c){return e[40]=a[6].get("source"),e[43]=d.i64.to_string(e[40]),e[43]!==void 0?e[41]=e[43]:e[41]=d.i64.to_string(d.i64.cast([0,0])),e[42]=",",d.nativeOperation(b("LSAppendDataTraceAddon.nop"),e[11],d.i64.cast([0,20]),d.i64.cast([0,1]),void 0,[e[41],e[42],d.i64.to_string(e[6]),e[42],d.i64.to_string(a[2])].join(""))}]):d.resolve()},function(b){return e[12]=a[6].get("blocked_by_otids"),e[13]=new d.Map(),e[14]=a[6].get("openEb"),e[15]=a[6].get("source"),e[16]=a[6].get("external_attachment_url"),e[17]=a[6].get("platform_ref"),e[18]=a[6].get("platform_token"),e[19]=a[6].get("reply_source_id"),e[20]=a[6].get("reply_source_attachment_id"),e[21]=a[6].get("reply_source_type"),e[22]=a[6].get("mark_read"),e[23]=a[6].get("initiating_app_id"),e[24]=a[6].get("initiating_source"),e[25]=a[6].get("navigation_chain"),e[26]=a[6].get("dety_params"),e[27]=a[6].get("skip_url_preview_gen"),e[28]=a[6].get("text_has_links"),e[29]=a[6].get("multitab_env"),e[30]=a[6].get("rich_text_format_type"),e[31]=a[6].get("plugin_type"),d.i64.eq(e[31],d.i64.cast([0,40]))?e[32]="Instamadillo":e[32]="FBBroker",d.db.table(31).add({taskId:e[10],threadKey:a[1],openEb:e[14],qplInstanceKey:e[0],offlineThreadingId:e[1],threadAttributionSource:e[15],externalAttachmentUrl:e[16],platformRef:e[17],platformToken:e[18],replySourceId:e[19],replySourceType:e[21],sendType:e[6],markThreadRead:e[22]==null?!1:e[22],initiatingSource:e[24],skipUrlPreviewGen:e[27],textHasLinks:e[28],dataclassParams:a[7],multitabEnv:e[29],richTextFormatType:e[30],transportKey:e[32]})},function(f){return c("gkx")("834")&&d.i64.eq(a[2],d.i64.cast([0,1]))?d.resolve(0):(e[40]=a[6].get("mark_read"),(e[40]==null?!1:e[40])?d.sequence([function(a){return d.nativeOperation(b("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_mark_thread_read_start",e[0])},function(c){return d.storedProcedure(b("LSOptimisticMarkThreadReadV2"),a[1],e[2])},function(a){return d.nativeOperation(b("LSMessageSendToSentQPLInteractionHelper.nop"),"sp_mark_thread_read_end",e[0])}]):d.resolve())},function(c){return e[33]=d.createArray(),e[34]=(e[33].push("optimisticSendMessageV2"),e[33]),e[35]=(e[33].push(a[1]),e[33]),e[36]=(e[33].push(e[1]),e[33]),e[37]=d.toJSON(e[33]),function(a){d.logger(a).info(a)}(e[37]),e[38]=new d.Map(),e[38].set("offline_threading_id",e[1]),e[38].set("task_id",e[10]),e[38].set("task_queue_name",d.i64.to_string(a[1])),e[38].set("task_label",d.i64.to_string(d.i64.cast([0,46]))),d.nativeOperation(b("LSLogEventAnnotate.nop"),d.i64.cast([0,16]),d.i64.cast([0,23]),d.i64.cast([0,0]),e[38])},function(a){return a=[e[1],e[10]],e[3]=a[0],e[4]=a[1],a}])},function(a){return f[0]=e[3]}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSMailboxOptimisticSendMessageV2StoredProcedure";a.__tables__=["threads","messages_optimistic_context"];d=a;g["default"]=d}),98);
__d("LSOptimisticSendMessageV2StoredProcedure",["LSOptimisticSendMessageV2","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOptimisticSendMessageV2"),e.senderId,e.threadKey,e.threadType,e.mailboxType,e.text,e.snippet,e.extraSendMessageParams,e.dataclassParams);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSRelayHooks",["ExecTimeResolverHooks"],(function(a,b,c,d,e,f){"use strict";Object.keys(importNamespace("ExecTimeResolverHooks")).forEach(function(a){if(a==="default"||a==="__esModule")return;f[a]=importNamespace("ExecTimeResolverHooks")[a]})}),null);
__d("LSRemoveMediaSendJobs",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMediaSendRemoveMediaSendJobsStoredProcedure";a.__tables__=["media_send_jobs"];e.exports=a}),null);
__d("LSRemoveMediaSendJobsStoredProcedure",["LSRemoveMediaSendJobs","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSRemoveMediaSendJobs"),e.offlineThreadingId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSSendPhase1MultiPhotoMessageV2",["LSArrayGetObjectAt","LSGetMessageAttributionParams","LSIssueSendAttachmentMessageTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.createArray(),d[1]=new c.Map(),d[2]=new c.Map(),d[3]=!1,d[4]=c.i64.cast([0,0]),c.forEach(c.sortBy(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),[["inMessageIndex","ASC"]]),function(a){a=a.item;return d[7]=a.fbid,d[4]=c.i64.add(d[4],c.i64.cast([0,1])),c.i64.neq(d[7],void 0)?d[8]=(d[0].push(d[7]),d[0]):0})},function(e){return d[5]=c.i64.of_int32(d[0].length),c.i64.neq(d[5],d[4])||c.i64.eq(d[4],c.i64.cast([0,0]))?c.resolve(d[6]=c.i64.cast([0,10002])):c.sequence([function(b){return c.db.table(12).fetch([[[a[0]]],"optimistic"]).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[void 0,void 0,void 0,void 0,void 0],d[7]=c[0],d[8]=c[1],d[9]=c[2],d[10]=c[3],d[11]=c[4],c):(b=a.item,c=[b.threadKey,b.senderId,b.text,b.replySourceId,b.replySourceTypeV2],d[7]=c[0],d[8]=c[1],d[9]=c[2],d[10]=c[3],d[11]=c[4],c)})},function(e){return c.i64.eq(d[7],void 0)||c.i64.eq(d[8],void 0)?c.resolve((c.i64.eq(d[7],void 0)?d[14]=c.i64.cast([0,10003]):d[14]=c.i64.cast([0,10004]),d[13]=d[14])):c.sequence([function(a){return c.db.table(9).fetch([[[d[7]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[14]=void 0:(b=a.item,d[14]=b.threadType)})},function(b){return c.filter(c.db.table(31).fetch(),function(b){return b.offlineThreadingId===a[0]}).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[void 0,void 0,void 0,void 0,void 0,void 0,void 0],d[16]=c[0],d[17]=c[1],d[18]=c[2],d[19]=c[3],d[20]=c[4],d[21]=c[5],d[22]=c[6],c):(b=a.item,c=[b.platformRef,b.platformToken,b.initiatingSource,void 0,void 0,b.dataclassParams,void 0],d[16]=c[0],d[17]=c[1],d[18]=c[2],d[19]=c[3],d[20]=c[4],d[21]=c[5],d[22]=c[6],c)})},function(e){return c.i64.neq(d[14],void 0)?c.sequence([function(e){return d[25]=d[1].keys(),d[26]=c.i64.of_int32(d[25].length),c.i64.gt(d[26],c.i64.cast([0,0]))?c.loopAsync(d[26],function(e){return d[32]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[25],d[32]).then(function(a){return a=a,d[33]=a[0],d[34]=a[1],a})},function(e){return d[35]=d[2].get(d[33]),d[36]=c.i64.to_string(d[35]),d[36]!==void 0?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[25],d[32]).then(function(a){return a=a,d[37]=a[0],d[38]=a[1],a})},function(b){return d[39]=d[1].get(d[33]),c.forEach(c.filter(c.db.table(16).fetch([[[d[7],a[0],d[37]]]]),function(b){return c.i64.eq(b.threadKey,d[7])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&b.messageId===a[0]&&b.attachmentFbid===d[37]}),function(a){var b=a.update;a.item;return b({attachmentFbid:d[36],originalFileHash:d[39]})})}]):c.resolve()}])}):c.resolve()},function(e){return c.storedProcedure(b("LSGetMessageAttributionParams"),a[0]).then(function(a){return a=a,d[27]=a[0],d[28]=a[1],d[29]=a[2],a})},function(e){return c.i64.neq(d[27],void 0)?d[30]=d[27]:d[30]=c.i64.cast([0,0]),c.storedProcedure(b("LSIssueSendAttachmentMessageTask"),d[8],d[7],d[14],a[0],d[9],d[0],d[30],d[10],d[11],d[3],d[16],d[17],a[1])},function(a){return c.i64.ge(c.i64.cast([0,0]),c.i64.cast([0,0]))?d[31]=void 0:d[31]=c.i64.cast([0,10006]),d[24]=d[31]}]):c.resolve(d[24]=c.i64.cast([0,10005]))},function(a){return d[13]=d[24]}])},function(a){return d[6]=d[13]}])},function(a){return e[0]=d[6]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMediaSendSendPhase1MultiPhotoMessageV2StoredProcedure";a.__tables__=["media_send_jobs","messages","threads","messages_optimistic_context","attachments"];e.exports=a}),null);
__d("LSResumeMediaSendJob",["LSInsertPhase2PendingTask","LSSendPhase1MultiPhotoMessageV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=new c.Map(),d[1]=new c.Map(),d[1].set("main_job_succeeded",!1),d[1].set("resume_failed",!1),d[1].set("error",void 0),d[1].set("running_sub_job_states",d[0]),d[2]=new c.Map(),d[2].set("should_transcode",!1),d[2].set("use_double_phase",!1),d[2].set("send_by_server",!1),d[2].set("is_secure",!1),d[2].set("should_dedupe",!1),d[2].set("is_optimistic_upload",!1),c.sortBy(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),[["state","ASC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?0:(b=a.item,d[2].set("should_transcode",b.shouldTranscode),d[2].set("use_double_phase",b.useDoublePhase),d[2].set("send_by_server",b.sendByServer),d[2].set("is_secure",b.isSecure),d[2].set("is_optimistic_upload",!1))})},function(b){return d[4]=new c.Map(),c.forEach(c.sortBy(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),[["inMessageIndex","ASC"]]),function(a){a=a.item;return d[13]=a.offlineAttachmentId,d[11]=a.state,d[12]=a.error,c.i64.eq(d[11],c.i64.cast([-1,4294967293]))?d[10]=!0:(c.i64.eq(d[11],c.i64.cast([0,1]))?d[14]=!0:(c.i64.eq(d[11],c.i64.cast([0,3]))?d[15]=!0:(c.i64.eq(d[11],c.i64.cast([0,5]))?d[16]=!0:(c.i64.eq(d[11],c.i64.cast([0,13]))?d[17]=!0:(c.i64.eq(d[11],c.i64.cast([0,7]))?d[18]=!0:(c.i64.eq(d[11],c.i64.cast([0,9]))?d[19]=!0:(c.i64.eq(d[11],c.i64.cast([0,11]))?d[20]=!0:d[20]=!1,d[19]=d[20]),d[18]=d[19]),d[17]=d[18]),d[16]=d[17]),d[15]=d[16]),d[14]=d[15]),d[10]=d[14]),d[10]?c.resolve(c.i64.eq(d[11],c.i64.cast([0,5]))||c.i64.eq(d[11],c.i64.cast([0,11]))?0:d[4].set(d[13],d[11])):c.i64.neq(d[12],void 0)?c.resolve((d[1].set("resume_failed",!0),d[1].set("error",d[12]))):(c.i64.eq(d[11],c.i64.cast([-1,4294967295]))?d[14]=c.i64.cast([0,5]):(c.i64.eq(d[11],c.i64.cast([-1,4294967294]))?(d[16]=d[2].get("should_transcode"),d[15]=d[16]?c.i64.cast([0,1]):c.i64.cast([0,3])):(c.i64.eq(d[11],c.i64.cast([0,2]))?d[16]=c.i64.cast([0,3]):(c.i64.eq(d[11],c.i64.cast([0,4]))?(d[18]=d[2].get("send_by_server"),d[19]=d[2].get("use_double_phase"),d[17]=d[18]?d[19]?c.i64.cast([0,13]):void 0:c.i64.cast([0,5])):(c.i64.eq(d[11],c.i64.cast([0,6]))?(d[19]=d[2].get("use_double_phase"),d[18]=d[19]?c.i64.cast([0,13]):void 0):(c.i64.eq(d[11],c.i64.cast([0,14]))?(d[20]=d[2].get("use_double_phase"),d[21]=d[2].get("should_transcode"),d[19]=d[20]?d[21]?c.i64.cast([0,7]):c.i64.cast([0,9]):void 0):(c.i64.eq(d[11],c.i64.cast([0,8]))?d[20]=c.i64.cast([0,9]):(c.i64.eq(d[11],c.i64.cast([0,10]))?(d[22]=d[2].get("send_by_server"),d[21]=d[22]?void 0:c.i64.cast([0,11])):(c.i64.eq(d[11],c.i64.cast([0,12]))?d[22]=void 0:d[22]=void 0,d[21]=d[22]),d[20]=d[21]),d[19]=d[20]),d[18]=d[19]),d[17]=d[18]),d[16]=d[17]),d[15]=d[16]),d[14]=d[15]),c.i64.neq(d[14],void 0)?c.sequence([function(a){return c.forEach(c.db.table(51).fetch([[[d[13]]]]),function(a){var b=a.update;a.item;return b({state:d[14]})})},function(a){return c.i64.eq(d[14],c.i64.cast([0,5]))||c.i64.eq(d[14],c.i64.cast([0,11]))?0:d[4].set(d[13],d[14])}]):c.resolve())})},function(b){return c.sortBy(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),[["state","ASC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[5]=void 0:(b=a.item,d[5]=b.state)})},function(e){return c.i64.neq(d[5],void 0)?(d[10]=d[2].get("send_by_server"),d[11]=d[2].get("use_double_phase"),d[12]=d[2].get("use_double_phase"),(d[10]?d[11]?c.i64.eq(d[5],c.i64.cast([0,10])):c.i64.eq(d[5],c.i64.cast([0,4])):d[12]?c.i64.eq(d[5],c.i64.cast([0,12])):c.i64.eq(d[5],c.i64.cast([0,6])))?c.resolve(d[1].set("main_job_succeeded",!0)):c.i64.eq(d[5],c.i64.cast([0,5]))?c.sequence([function(b){return d[13]=void 0,c.forEach(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),function(a){a=a.item;return d[15]=a.error,c.i64.eq(d[15],void 0)?(c.i64.neq(a.fbid,void 0)?d[16]=void 0:d[16]=c.i64.cast([0,9]),d[14]=d[16]):d[14]=d[15],c.i64.neq(d[14],void 0)?d[13]=d[14]:0})},function(e){return c.i64.neq(d[13],void 0)?c.resolve((d[1].set("resume_failed",!0),d[1].set("error",d[13]))):(d[14]=d[2].get("is_optimistic_upload"),d[14]?(d[15]=d[2].get("send_by_server"),d[16]=d[2].get("use_double_phase"),d[17]=d[2].get("use_double_phase"),(d[15]?d[16]?c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,10])):c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,4])):d[17]?c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,12])):c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,6])))?c.resolve(d[1].set("main_job_succeeded",!0)):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([-1,4294967295]))?d[18]=c.i64.cast([0,5]):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([-1,4294967294]))?(d[20]=d[2].get("should_transcode"),d[19]=d[20]?c.i64.cast([0,1]):c.i64.cast([0,3])):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,2]))?d[20]=c.i64.cast([0,3]):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,4]))?(d[22]=d[2].get("send_by_server"),d[23]=d[2].get("use_double_phase"),d[21]=d[22]?d[23]?c.i64.cast([0,13]):void 0:c.i64.cast([0,5])):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,6]))?(d[23]=d[2].get("use_double_phase"),d[22]=d[23]?c.i64.cast([0,13]):void 0):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,14]))?(d[24]=d[2].get("use_double_phase"),d[25]=d[2].get("should_transcode"),d[23]=d[24]?d[25]?c.i64.cast([0,7]):c.i64.cast([0,9]):void 0):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,8]))?d[24]=c.i64.cast([0,9]):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,10]))?(d[26]=d[2].get("send_by_server"),d[25]=d[26]?void 0:c.i64.cast([0,11])):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,12]))?d[26]=void 0:d[26]=void 0,d[25]=d[26]),d[24]=d[25]),d[23]=d[24]),d[22]=d[23]),d[21]=d[22]),d[20]=d[21]),d[19]=d[20]),d[18]=d[19]),c.i64.neq(d[18],void 0)?c.sequence([function(b){return c.forEach(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),function(a){var b=a.update;a.item;return b({state:d[18]})})},function(b){return c.forEach(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),function(a){a=a.item;return d[4].set(a.offlineAttachmentId,a.state)})}]):c.resolve())):c.sequence([function(e){return d[15]=d[2].get("is_secure"),d[15]?c.sequence([function(b){return d[17]=c.createArray(),d[18]=new c.Map(),d[19]=new c.Map(),d[20]=!1,d[21]=c.i64.cast([0,0]),c.forEach(c.sortBy(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),[["inMessageIndex","ASC"]]),function(a){a=a.item;return d[26]=a.fbid,d[21]=c.i64.add(d[21],c.i64.cast([0,1])),c.i64.neq(d[26],void 0)?d[27]=(d[17].push(d[26]),d[17]):0})},function(b){return d[22]=c.createArray(),c.forEach(c.sortBy(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),[["inMessageIndex","ASC"]]),function(a){a=a.item;return d[26]=a.metadata,d[26]!==void 0?d[27]=(d[22].push(d[26]),d[22]):0})},function(a){return d[23]=c.i64.of_int32(d[17].length),d[24]=c.i64.of_int32(d[22].length),c.i64.neq(d[23],d[21])||c.i64.neq(d[24],d[21])?d[25]=c.i64.cast([0,11]):(function(a){c.logger(a).debug(a)}("[TincanLS][LSSecureMailboxSendSecureMediaMessageStoredProcedure] Started"),function(a){c.logger(a).debug(a)}("[TincanLS][LSSecureMailboxSendSecureMediaMessageStoredProcedure] Completed"),d[25]=void 0),d[16]=d[25]}]):c.sequence([function(e){return c.storedProcedure(b("LSSendPhase1MultiPhotoMessageV2"),a[0],a[2]).then(function(a){return a=a,d[17]=a[0],a})},function(b){return c.i64.eq(d[17],void 0)?c.forEach(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),function(a){var b=a.update;a.item;return b({state:c.i64.cast([0,6])})}):c.resolve()},function(a){return d[16]=d[17]}])},function(b){return c.i64.eq(d[16],void 0)?(d[17]=d[2].get("send_by_server"),d[18]=d[2].get("use_double_phase"),d[19]=d[2].get("use_double_phase"),(d[17]?d[18]?c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,10])):c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,4])):d[19]?c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,12])):c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,6])))?c.resolve(d[1].set("main_job_succeeded",!0)):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([-1,4294967295]))?d[20]=c.i64.cast([0,5]):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([-1,4294967294]))?(d[22]=d[2].get("should_transcode"),d[21]=d[22]?c.i64.cast([0,1]):c.i64.cast([0,3])):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,2]))?d[22]=c.i64.cast([0,3]):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,4]))?(d[24]=d[2].get("send_by_server"),d[25]=d[2].get("use_double_phase"),d[23]=d[24]?d[25]?c.i64.cast([0,13]):void 0:c.i64.cast([0,5])):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,6]))?(d[25]=d[2].get("use_double_phase"),d[24]=d[25]?c.i64.cast([0,13]):void 0):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,14]))?(d[26]=d[2].get("use_double_phase"),d[27]=d[2].get("should_transcode"),d[25]=d[26]?d[27]?c.i64.cast([0,7]):c.i64.cast([0,9]):void 0):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,8]))?d[26]=c.i64.cast([0,9]):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,10]))?(d[28]=d[2].get("send_by_server"),d[27]=d[28]?void 0:c.i64.cast([0,11])):(c.i64.eq(c.i64.cast([0,6]),c.i64.cast([0,12]))?d[28]=void 0:d[28]=void 0,d[27]=d[28]),d[26]=d[27]),d[25]=d[26]),d[24]=d[25]),d[23]=d[24]),d[22]=d[23]),d[21]=d[22]),d[20]=d[21]),c.i64.neq(d[20],void 0)?c.sequence([function(b){return c.forEach(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),function(a){var b=a.update;a.item;return b({state:d[20]})})},function(b){return c.forEach(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),function(a){a=a.item;return d[4].set(a.offlineAttachmentId,a.state)})}]):c.resolve())):c.resolve((d[1].set("resume_failed",!0),d[1].set("error",d[16])))}]))}]):c.i64.eq(d[5],c.i64.cast([0,11]))?c.sequence([function(b){return d[13]=void 0,c.forEach(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),function(a){a=a.item;return d[14]=a.error,c.i64.neq(d[14],void 0)?d[13]=d[14]:0})},function(a){return c.i64.neq(d[13],void 0)?(d[1].set("resume_failed",!0),d[1].set("error",d[13])):d[1].set("main_job_succeeded",!0)}]):c.i64.eq(d[5],c.i64.cast([0,13]))?c.sequence([function(e){return c.storedProcedure(b("LSInsertPhase2PendingTask"),a[0],a[1]).then(function(a){return a=a,d[13]=a[0],a})},function(b){return c.i64.neq(d[13],void 0)?c.resolve((d[1].set("resume_failed",!0),d[1].set("error",d[13]))):c.sequence([function(b){return c.forEach(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),function(a){var b=a.update;a.item;return b({state:c.i64.cast([0,14])})})},function(b){return d[1].set("main_job_succeeded",!0),c.forEach(c.filter(c.db.table(51).fetch(),function(b){return b.offlineThreadingId===a[0]}),function(a){a=a.item;return d[4].set(a.offlineAttachmentId,a.state)})}])}]):c.resolve(0)):c.resolve((d[1].set("resume_failed",!0),d[1].set("error",c.i64.cast([0,11]))))},function(a){return d[7]=d[1].get("main_job_succeeded"),d[8]=d[1].get("resume_failed"),d[9]=d[1].get("error"),a=[d[7],d[8],d[9],d[4]],e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMediaSendResumeMediaSendJobStoredProcedure";a.__tables__=["media_send_jobs"];e.exports=a}),null);
__d("LSResumeMediaSendJobStoredProcedure",["LSResumeMediaSendJob","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSResumeMediaSendJob"),e.jobId,e.pluginType,e.dataTraceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWDocumentPreProcess",["Promise","WABlobToArrayBuffer","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["start document preprocess"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["start optimistic document preprocess"]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS(["MAWDocumentPreProcess"]);function e(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){k.DEV(i());return(h||(h=b("Promise"))).resolve({file:a,filename:a.name,plaintext:c("gkx")("1540")?yield d("WABlobToArrayBuffer").blobToArrayBuffer(a):null,type:"document"})});return l.apply(this,arguments)}function f(c){k.DEV(j());var d=a.URL.createObjectURL(c);return(h||(h=b("Promise"))).resolve({file:c,filename:c.name,type:"document",url:d})}g.documentPreprocess=e;g.optimisticDocumentPreprocess=f}),98);
__d("MAWMediaPreProcessQpl",["MAWSendQplToServer","Random","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=typeof self.BigInt==="function",i=c("justknobx")._("3427")*1e3;function a(a,b){var e=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);a=d("MAWSendQplToServer").startQplUserFlow(c("qpl")._(1056840460,"718"),{bool:{has_big_int_support:h},string:{preprocess_type:a}},e,i);b&&a.addAnnotations({"int":{input_file_size:b.size},string:{mimetype:b.type}});return a}g.startMediaPreProcessQpl=a}),98);
__d("WABlobToImage",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a){var c;return new(g||(g=b("Promise")))(function(b,d){c=new Image();var e=URL.createObjectURL(a),f=function(){return URL.revokeObjectURL(e)};c.onload=function(){b({image:c,releaseImageMemory:f})};c.onerror=function(){f(),d("loadBlobToImage error")};c.src=e})}f.blobToImage=a}),66);
__d("WADecodeImage",["WABlobToImage","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["start decoding image with DOM: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["start decoding image without DOM: ",""]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["decodeImage"]);e=typeof self.createImageBitmap==="function"&&typeof self.OffscreenCanvas==="function";f=e?a:c;function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){j.DEV(i(),a.name);a=(yield self.createImageBitmap(a));var b=a.width,c=a.height,d=new self.OffscreenCanvas(b,c);d=m({canvas:d,width:b,height:c,image:a});return d});return k.apply(this,arguments)}function c(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){j.DEV(h(),a.name);a=(yield d("WABlobToImage").blobToImage(a));var b=a.image;a=a.releaseImageMemory;var c=document.createElement("canvas");c=m({canvas:c,width:b.naturalWidth,height:b.naturalHeight,image:b});a();return c});return l.apply(this,arguments)}function m(a){var b=a.canvas,c=a.image,d=a.width;a=a.height;b.width=d;b.height=a;var e=b.getContext("2d");e.fillStyle="rgb(255,255,255)";e.fillRect(0,0,b.width,b.height);e.drawImage(c,0,0);b=e.getImageData(0,0,d,a);return b}g.canDecodeWithoutDOM=e;g.decodeImage=f;g.decodeImageWithoutDOM=a;g.decodeImageWithDOM=c}),98);
__d("MAWImagePreProcess",["MAWGetImageSpec","MAWImageUtils","MAWMediaPreProcessQpl","Promise","WABlobToArrayBuffer","WACustomError","WADecodeImage","WAMediaWasmWorkerClient","WAPromiseTimeout","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","cometIsMimeTypeForMedia","err","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["finished jpeg transcoding through mozjpeg: "," bytes"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["start process image through wasm, file name: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error while transcoding image through browser api: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["start image transcode ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error while processing url to thumbnail in worker: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["finished image transcoding through browser api: "," bytes"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["start image transcoding through browser api"]);o=function(){return a};return a}var p=12e4,q=d("WATagsLogger").TAGS(["ImagePreProcess"]),r=85,s=["image/heic"];function e(a,e,f){var g;e?g=a.type==="image/webp"?(h||(h=b("Promise"))).resolve(a):v(a,"image/webp",e,f):g=a.type==="image/gif"?(h||(h=b("Promise"))).resolve(a):v(a,"image/jpeg",!1,f);f=a.type==="image/gif"&&c("gkx")("8554");return f?g.then(function(a){return(h||(h=b("Promise"))).all([d("MAWGetImageSpec").getImageSpec(a),a])}).then(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var f=b[0];b=b[1];return{file:b,imageSpec:f,plaintext:c("gkx")("1540")?yield d("WABlobToArrayBuffer").blobToArrayBuffer(b):null,thumbnailUrlAndSpec:null,type:u(a,e)}});return function(a){return f.apply(this,arguments)}}()):g.then(function(e){return(h||(h=b("Promise"))).all([B(a,c("justknobx")._("2033")),d("MAWGetImageSpec").getImageSpec(e),e])}).then(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(f){var g=f[0],i=f[1];f=f[2];return(h||(h=b("Promise"))).resolve({file:f,imageSpec:i,plaintext:c("gkx")("1540")?yield d("WABlobToArrayBuffer").blobToArrayBuffer(f):null,thumbnailUrlAndSpec:g,type:u(a,e)})});return function(a){return f.apply(this,arguments)}}())}function f(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){var f=a.URL.createObjectURL(b),g=e===!0?c("justknobx")._("2545"):c("justknobx")._("2033"),h=u(b,e),i,j;h=h==="animated_image"&&c("gkx")("8554");h||(i=(yield d("MAWImageUtils").urlToThumbnailSpec(f,g)),j={height:i.height,width:i.width});return{file:b,imageSpec:j,thumbnailSpec:i,type:u(b,e),url:f}});return t.apply(this,arguments)}function u(a,b){return b===!0?"sticker":a.type==="image/gif"?"animated_image":"image"}function v(a,b,c,d){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){q.DEV(l(),a.name);var i=d("MAWMediaPreProcessQpl").startMediaPreProcessQpl("image",a);i.addAnnotations({"int":{total_number_of_files:(g=g)!=null?g:1},string:{targetMimetype:e}});var j=function(){return y(a,e,r,f).then(function(a){return a.success?a.value:(h||(h=b("Promise"))).reject("runtime-error")})["catch"](function(a){q.ERROR(k(),a);i.addPoint("native_encode_failure",{string:{native_encode_error:a.toString()}});return null})};g=e==="image/jpeg"?yield d("WAPromiseTimeout").promiseTimeout(z(a,r,i).then(function(a){return a.success?a.value:(h||(h=b("Promise"))).reject(a.error)}),p)["catch"](function(a){a instanceof d("WACustomError").TimeoutError?i.addPoint("mozjpeg_encode_timeout"):i.addPoint("mozjpeg_encode_failure",{string:{mozjpeg_encode_error:a.toString()}});return j()}):yield j();if(g==null){i.endFail("unable_to_transcode_image");throw c("err")("unable to transcode image")}i.endSuccess({"int":{compressed_file_size:g.size}});return g});return w.apply(this,arguments)}function x(b,c){b=a.URL.createObjectURL(b);return d("MAWImageUtils").urlToThumbnail(b,c)}function y(b,c,e,f){q.DEV(o());var g=a.URL.createObjectURL(b),h=b.name;return d("MAWImageUtils").urlToFile(g,c,e,f).then(function(a){a=a.blob;q.DEV(n(),a.size);return d("WAResultOrError").makeResult(new File([a],h,{type:c}))})}function z(a,b,c){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){q.LOG(j(),a.name);var f=c("gkx")("4944");d("WAMediaWasmWorkerClient").prewarmMediaWasmWorker("progressiveJpegEncode");e.addPoint("prewarm_worker_started");var g;d("WADecodeImage").canDecodeWithoutDOM&&(g=(yield d("WAMediaWasmWorkerClient").progressiveJpegEncodeInWorkerWithFile({eventFlow:e,file:a,quality:b,useHdScanConfig:!0})));if(g==null||!g.success&&g.error==="decode-image-error"&&f){f=(yield d("WADecodeImage").decodeImageWithDOM(a)["catch"](function(a){e.addPoint("image_decode_failure");throw a}));e.addPoint("image_decode_success");g=(yield d("WAMediaWasmWorkerClient").progressiveJpegEncodeInWorker({eventFlow:e,imageData:f,quality:b,useHdScanConfig:!0}))}if(!g.success)return g;e.addPoint("pjpeg_encode_success");q.LOG(i(),g.value.byteLength);return d("WAResultOrError").makeResult(new File([g.value],a.name,{type:"image/jpeg"}))});return A.apply(this,arguments)}function B(e,f){var g=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=a.URL.createObjectURL(e),c=(yield d("MAWImageUtils").urlToThumbnail(b,f));a.URL.revokeObjectURL(b);return c});return function(){return c.apply(this,arguments)}}();if(!d("WADecodeImage").canDecodeWithoutDOM)return g();var h=c("justknobx")._("2338")*1024,i=c("justknobx")._("2340");return d("WAPromiseTimeout").promiseTimeout(d("WAMediaWasmWorkerClient").generateImageThumbnailInWorker({file:e,maxDimension:f,thumbnailBlobByteSizeLimitBytes:h,thumbnailQualityPercentageWhenAboveByteSizeLimit:i}).then(function(a){if(!a.success)throw c("err")("urlToFileInWorker error: "+a.error);return{height:a.value.height,jpegThumbnail:a.value.blob,width:a.value.width}})["catch"](function(a){q.ERROR(m(),a);throw a}),p)["catch"](function(a){return g()})}function C(a){if(a==="image/gif"||a==="image/webp")return!0;return!d("cometIsMimeTypeForMedia").isMimeTypeForPhoto(a)?!1:!s.includes(a)}g.imagePreprocess=e;g.optimisticImagePreprocess=f;g.getJpegThumbnailInfo=x;g.generateImageThumbnailInWorkerWithFallback=B;g.isSupportedImageFileType=C}),98);
__d("useShouldShowPlaybackErrorFallback",["MAWVideoAudioPlaybackErrorHandlerUtils","cr:5868","react-compiler-runtime","useEmptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h=(e=b("cr:5868"))!=null?e:c("useEmptyFunction");function a(a,b){var c=d("react-compiler-runtime").c(3);b=(b=h(a,b))!=null?b:{};b=b.validationResult;if(a==null)return!1;var e;c[0]!==a||c[1]!==b?(e=d("MAWVideoAudioPlaybackErrorHandlerUtils").isInvalidVideo(a,b),c[0]=a,c[1]=b,c[2]=e):e=c[2];return e}g["default"]=a}),98);
__d("useShouldShowUnsupportedCodecFallback",["MAWVideoAudioPlaybackErrorHandlerUtils","cr:5868","react-compiler-runtime","useEmptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h=(e=b("cr:5868"))!=null?e:c("useEmptyFunction");function a(a,b){var c=d("react-compiler-runtime").c(3);b=(b=h(a,b))!=null?b:{};b=b.validationResult;if(a==null)return!1;var e;c[0]!==a||c[1]!==b?(e=d("MAWVideoAudioPlaybackErrorHandlerUtils").isUnsupportedVideo(a,b),c[0]=a,c[1]=b,c[2]=e):e=c[2];return e}g["default"]=a}),98);
__d("useMAWBulkMediaValidationResult",["I64","LSIntEnum","MAWBridgeSendAndReceive","MAWDbMedia","MAWStateContext.react","MessagingAttachmentType","WAHashUtils","gkx","promiseDone","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=h||d("react");var k=b.useContext,l=b.useEffect;b.useMemo;var m=new Set();function n(a){var b=d("react-compiler-runtime").c(4),e=k(d("MAWStateContext.react").MAWDispatchContext),f,g;b[0]!==a||b[1]!==e?(f=function(){a.forEach(function(a){var b=a.attachment;a=a.mediaRenderQpl;var f=(i||(i=d("I64"))).equal(b.attachmentType,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO)),g=i.equal(b.attachmentType,j.ofNumber(c("MessagingAttachmentType").AUDIO)),h=b.attachmentFbid;if(!m.has(h)&&(f||g)){m.add(h);var k=isNaN(h);b=k?d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaValidationResultByPlainTextHash",{plaintextHash:d("WAHashUtils").stringToPlaintextHash(h),qplInstanceKey:a==null?void 0:a.getInstanceKey()}):d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaValidationResultByMediaId",{mediaId:d("MAWDbMedia").convertNumberToMediaId(parseInt(h,10)),qplInstanceKey:a==null?void 0:a.getInstanceKey()});c("promiseDone")(b.then(function(a){a!=null&&e({tag:"SetMediaValidatedResult",value:{key:k?d("WAHashUtils").stringToPlaintextHash(h):d("MAWDbMedia").convertNumberToMediaId(parseInt(h,10)),validatedResult:a}})}),o)}})},g=[a,e],b[0]=a,b[1]=e,b[2]=f,b[3]=g):(f=b[2],g=b[3]);l(f,g)}function o(){}function a(a){var b=d("react-compiler-runtime").c(9),e=d("MAWStateContext.react").useMAWSelector(p);n(a);var f,g;b[0]!==a||b[1]!==e?(f=function(){for(var b=a,f=Array.isArray(b),g=0,b=f?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=b.length)break;h=b[g++]}else{g=b.next();if(g.done)break;h=g.value}h=h;var k=h.attachment;h=h.mediaRenderQpl;var l=(i||(i=d("I64"))).equal(k.attachmentType,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO)),m=i.equal(k.attachmentType,j.ofNumber(c("MessagingAttachmentType").VIDEO));if(!l&&!m)continue;if(l&&!c("gkx")("8785"))continue;m=Object.prototype.hasOwnProperty.call(e,k.attachmentFbid);if(!m)continue;m=(l=e[k.attachmentFbid])==null?void 0:l.validationResult;if(m==null)continue;h==null?void 0:h.addAnnotations({"int":{audio_avg_bits_per_second:m.audioAvgBitsPerSecond,audio_number_of_channels:m.audioNumberOfChannels,audio_sampling_rate:m.audioSamplingRate,video_avg_bits_per_second:m.videoAvgBitsPerSecond,video_calculated_fps:m.videoCalculatedFps,video_duration:m.videoDuration,video_height:m.videoHeight,video_nominal_fps:m.videoNominalFps,video_width:m.videoWidth},string:{audio_stream_type:m.audioStreamType,validated_mime_type:m.validatedMimeType,video_stream_type:m.videoStreamType}})}},g=[a,e],b[0]=a,b[1]=e,b[2]=f,b[3]=g):(f=b[2],g=b[3]);l(f,g);if(b[4]!==a||b[5]!==e){b[7]!==e?(f=function(a){a=a.attachment;var b=(i||(i=d("I64"))).equal(a.attachmentType,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO)),f=i.equal(a.attachmentType,j.ofNumber(c("MessagingAttachmentType").VIDEO));if(!b&&!f)return null;if(b&&!c("gkx")("8785"))return null;f=Object.prototype.hasOwnProperty.call(e,a.attachmentFbid);if(!f)return null;f=(b=e[a.attachmentFbid])==null?void 0:b.validationResult;return f==null?null:f},b[7]=e,b[8]=f):f=b[8];g=a.map(f);b[4]=a;b[5]=e;b[6]=g}else g=b[6];f=g;return f}function p(a){return a.mediaDownloadStatus}g["default"]=a}),98);
__d("useMAWMediaValidationResultState",["react","react-compiler-runtime","useMAWBulkMediaValidationResult"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b,e){var f=d("react-compiler-runtime").c(4);if(f[0]!==a||f[1]!==e||f[2]!==b){var g;g=a!=null?[{attachment:a,mediaRenderQpl:b,statusKey:(g=e)!=null?g:a.attachmentFbid}]:[];f[0]=a;f[1]=e;f[2]=b;f[3]=g}else g=f[3];a=g;e=a;b=c("useMAWBulkMediaValidationResult")(e);return b.length>0?b[0]:null}g["default"]=a}),98);
__d("useMWV2MediaViewerSecurePlayableUrl",["cr:5970","react"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useCallback;function a(){return i}function i(a,c,d){return(a=b("cr:5970")==null?void 0:b("cr:5970").getAttachmentBlob(a,c,d))!=null?a:""}g["default"]=a}),98);
__d("MAWVideoAudioPlaybackErrorHandlerUtils",["fbt","BaseMiddot.react","I64","LSIntEnum","MWXLink.react","MessagingAttachmentType","MessengerWebUXLoggerImpl","ReQL","ReQLSuspense","UserAgent","gkx","react","react-compiler-runtime","useMAWMediaValidationResultState","useMWV2MediaViewerSecurePlayableUrl","useReStore","useShouldShowPlaybackErrorFallback","useShouldShowUnsupportedCodecFallback"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m=l||c("react");function n(a){a=a.silent;return a===!0?c("gkx")("5198"):c("gkx")("5211")}function a(a){a=a.silent;return a===!0?c("gkx")("5235"):c("gkx")("5475")}function b(a,b,e){var f,g,j=d("react-compiler-runtime").c(21);f=(f=c("useShouldShowPlaybackErrorFallback")(a,null))!=null?f:!1;g=(g=c("useShouldShowUnsupportedCodecFallback")(a,null))!=null?g:!1;var l=d("MessengerWebUXLoggerImpl").useInteractionLogger(),n=c("useMWV2MediaViewerSecurePlayableUrl")();if(f){j[0]===Symbol["for"]("react.memo_cache_sentinel")?(f={downloadButton:null,mediaStatusText:h._(/*BTDS*/"__JHASH__xqsOpg5ebEg__JHASH__"),retryButton:null},j[0]=f):f=j[0];return f}if(g){f=(i||(i=d("I64"))).equal(a.attachmentType,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO));g=i.equal(a.attachmentType,k.ofNumber(c("MessagingAttachmentType").AUDIO));if(f){j[1]===Symbol["for"]("react.memo_cache_sentinel")?(f=m.jsx(c("BaseMiddot.react"),{}),j[1]=f):f=j[1];var o;j[2]!==a||j[3]!==n?(o=n(a,"MAWVideoAudioPlaybackErrorHandlerUtils"),j[2]=a,j[3]=n,j[4]=o):o=j[4];j[5]!==l?(a=function(){l==null?void 0:l({eventName:"click_unsupported_video_download_from_mustache"})},j[5]=l,j[6]=a):a=j[6];j[7]===Symbol["for"]("react.memo_cache_sentinel")?(n=h._(/*BTDS*/"__JHASH__3MspJ4rRDaT__JHASH__"),j[7]=n):n=j[7];j[8]!==o||j[9]!==a?(f=m.jsxs(m.Fragment,{children:[f,m.jsx(c("MWXLink.react"),{download:!0,href:o,onClick:a,children:n})]}),j[8]=o,j[9]=a,j[10]=f):f=j[10];n=f;j[11]===Symbol["for"]("react.memo_cache_sentinel")?(o=h._(/*BTDS*/"__JHASH___WcmsG0Qigq__JHASH__"),j[11]=o):o=j[11];j[12]!==n?(a={downloadButton:n,mediaStatusText:o,retryButton:null},j[12]=n,j[13]=a):a=j[13];return a}if(g){j[14]===Symbol["for"]("react.memo_cache_sentinel")?(f={downloadButton:null,mediaStatusText:h._(/*BTDS*/"__JHASH__dlUr-xJMkca__JHASH__"),retryButton:null},j[14]=f):f=j[14];return f}}j[15]!==b||j[16]!==e?(o=b?m.jsxs(m.Fragment,{children:[m.jsx(c("BaseMiddot.react"),{}),m.jsx(c("MWXLink.react"),{onClick:e,children:h._(/*BTDS*/"__JHASH__BGxC_0TtXwE__JHASH__")})]}):null,j[15]=b,j[16]=e,j[17]=o):o=j[17];n=o;j[18]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._(/*BTDS*/"__JHASH__jCbL2nmLvOs__JHASH__"),j[18]=a):a=j[18];j[19]!==n?(g={downloadButton:null,mediaStatusText:a,retryButton:n},j[19]=n,j[20]=g):g=j[20];return g}function e(a){var b=d("react-compiler-runtime").c(7),e=(j||(j=c("useReStore")))(),g;b[0]!==e.tables.attachments||b[1]!==a.messageId||b[2]!==a.threadKey?(g=function(){return d("ReQL").fromTableAscending(e.tables.attachments).getKeyRange(a.threadKey,a.messageId)},b[0]=e.tables.attachments,b[1]=a.messageId,b[2]=a.threadKey,b[3]=g):g=b[3];var h;b[4]!==e||b[5]!==a?(h=[e,a],b[4]=e,b[5]=a,b[6]=h):h=b[6];b=d("ReQLSuspense").useFirst(g,h,f.id+":169");g=c("useMAWMediaValidationResultState")(b);if(b==null)return!1;h=(i||(i=d("I64"))).equal(b.attachmentType,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))||(i||(i=d("I64"))).equal(b.attachmentType,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO));if(!h)return!1;h=(b=g)!=null?b:{};g=h.validatedMimeType;return n({silent:!1})&&g==="invalid-mp4"?!0:!1}var o=Object.freeze({Chrome:["H263","Vvc","Av1"],Edge:["H263","Vvc","Av1"],Firefox:["H263","Vvc","Hevc","Av1"],Safari:["H263","Vvc","Vp9","Av1"]});function p(a){if(a==null)return!0;if(c("UserAgent").isBrowser("Chrome"))return o.Chrome.includes(a)===!1;else if(c("UserAgent").isBrowser("Firefox"))return o.Firefox.includes(a)===!1;else if(c("UserAgent").isBrowser("Edge"))return o.Edge.includes(a)===!1;else if(c("UserAgent").isBrowser("Safari"))return o.Safari.includes(a)===!1;return!0}function q(a,b){a=a.attachmentType;a=(i||(i=d("I64"))).equal(a,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))||(i||(i=d("I64"))).equal(a,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO));if(!a)return!1;a=n({silent:!1});if(!a)return!1;b=(a=b)!=null?a:{};a=b.validatedMimeType;b=b.videoStreamType;return p(b)===!1||a==="unsupported-video"}function r(a,b){a=a.attachmentType;a=(i||(i=d("I64"))).equal(a,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))||(i||(i=d("I64"))).equal(a,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO));if(!a)return!1;a=n({silent:!1});if(!a)return!1;b=(a=b)!=null?a:{};a=b.validatedMimeType;return a==="invalid-mp4"}g.isVideoFallbackExperiencesEnabled=n;g.isInvalidVideoSendBlockEnabled=a;g.useGetMetadataForMediaNotRendered=b;g.useIsInvalidVideoMessage=e;g.isUnsupportedVideo=q;g.isInvalidVideo=r}),226);
__d("MAWVideoUtils",["MAWImageUtils","Promise","err","generateVideoThumbnails"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var e=document.body;if(!e)return new(h||(h=b("Promise")))(function(a,b){return b("Unable to find DOM body, please use this util only in DOM environment.")});var f=document.createElement("video");return new(h||(h=b("Promise")))(function(d,g){f.setAttribute("style","display: none"),f.setAttribute("src",URL.createObjectURL(a)),f.addEventListener("loadedmetadata",function(a){a=a.currentTarget;if(a instanceof HTMLVideoElement){var e=a.duration,i=a.videoHeight;a=a.videoWidth;var j=c("generateVideoThumbnails")(f,a,i,1);d((h||(h=b("Promise"))).all([j,a,i,Math.ceil(e)]))}else g("EventTarget returned for event should be HTMLVideoElement")}),f.addEventListener("error",function(a){g("Unable to load video")}),e.appendChild(f)}).then(function(a){var b=a[0],c=a[1],g=a[2],h=a[3];e.removeChild(f);return d("MAWImageUtils").canvasToBlob(b.thumbnails[0].getCanvas(),d("MAWImageUtils").TYPE_JPEG,!0).then(function(a){return a.arrayBuffer().then(function(a){return{duration:h,height:g,jpegThumbnail:a,width:c}})})})["catch"](function(a){e.removeChild(f);throw c("err")(a)})}function e(a){var d=document.body;if(!d)return new(h||(h=b("Promise")))(function(a,b){return b("Unable to find DOM body, please use this util only in DOM environment.")});var e=document.createElement("video");return new(h||(h=b("Promise")))(function(b,c){e.setAttribute("style","display: none"),e.setAttribute("src",URL.createObjectURL(a)),e.addEventListener("loadedmetadata",function(a){a=a.currentTarget;if(a instanceof HTMLVideoElement){var d=a.duration,e=a.videoHeight;a=a.videoWidth;b({duration:Math.ceil(d),height:e,width:a})}else c("EventTarget returned for event should be HTMLVideoElement")}),e.addEventListener("error",function(a){c("Unable to load video")}),d.appendChild(e)})["catch"](function(a){d.removeChild(e);throw c("err")(a)})}g.getVideoThumbnailUrlAndSpec=a;g.getVideoThumbnailSpec=e}),98);
__d("MWCMIsSubthreadContext.react",["react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));c=h;e=c.createContext;var j=c.useContext;c.useMemo;var k=e({isSubthread:!1});function a(){return j(k)}function b(a){var b=d("react-compiler-runtime").c(5),c=a.children;a=a.isSubthread;var e;b[0]!==a?(e={isSubthread:a},b[0]=a,b[1]=e):e=b[1];a=e;e=a;b[2]!==c||b[3]!==e?(a=i.jsx(k.Provider,{value:e,children:c}),b[2]=c,b[3]=e,b[4]=a):a=b[4];return a}g.useIsSubthreadContext=a;g.MWCMIsSubthreadContextProvider=b}),98);
__d("MWChatComposerMentionsViewItem.react",["CometImageFromIXValue.react","CometSearchMentionsBaseViewItem.react","FDSIcon.react","FDSProfilePhoto.react","FDSTextPairing.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j={image:{height:"x1fgtraw",width:"xgd8bvy",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(18),e,f;b[0]!==a?(e=a.entry,f=babelHelpers.objectWithoutPropertiesLoose(a,["entry"]),b[0]=a,b[1]=e,b[2]=f):(e=b[1],f=b[2]);a=e;var g=a.handle,h=a.key,k=a.label;a=a.rawData;var l=a.icon,m=a.image,n=a.photoURI;a=a.subtitle;var o;if(n!=null){var p;b[3]!==n?(p=i.jsx(c("FDSProfilePhoto.react"),{size:28,source:{uri:n}}),b[3]=n,b[4]=p):p=b[4];o=p}else if(l!=null){b[5]!==l?(n=i.jsx(c("FDSIcon.react"),{color:"primary",disabled:!1,icon:l}),b[5]=l,b[6]=n):n=b[6];o=n}else if(m!=null){b[7]!==m?(p=i.jsx(c("CometImageFromIXValue.react"),{source:m,xstyle:j.image}),b[7]=m,b[8]=p):p=b[8];o=p}n="mention("+((l=g)!=null?l:h)+")";b[9]!==k||b[10]!==a?(m=i.jsx(c("FDSTextPairing.react"),{body:k,bodyLineLimit:1,level:3,meta:a,metaLineLimit:1}),b[9]=k,b[10]=a,b[11]=m):m=b[11];b[12]!==e||b[13]!==o||b[14]!==f||b[15]!==n||b[16]!==m?(p=i.jsx(c("CometSearchMentionsBaseViewItem.react"),babelHelpers["extends"]({},f,{entry:e,itemStartContent:o,testid:void 0,children:m})),b[12]=e,b[13]=o,b[14]=f,b[15]=n,b[16]=m,b[17]=p):p=b[17];return p}g["default"]=a}),98);
__d("MWChatComposerMentionsUtils",["remove-accents"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b.length===0)return!0;var d=c("remove-accents")(b).toLowerCase();b=c("remove-accents")(a).toLowerCase();return b.split(" ").some(function(a){return a.startsWith(d)})||b.startsWith(d)}g.doesParticipantNameMatch=a}),98);
__d("MWChatComposerTypeaheadUtil",["fbt","ix","MWChatComposerMentionsUtils","gkx"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=h._(/*BTDS*/"__JHASH__5zKX9L3wCmC__JHASH__").toString(),k={decorType:"regular",handle:j,key:"0",label:j,rawData:{image:i("391426"),subtitle:void 0},type:"entry"};function a(a,b,e,f,g,i,l){var m=a.query,n=[];g===!0&&d("MWChatComposerMentionsUtils").doesParticipantNameMatch(j,m)&&n.push(k);if(g===!0?i:!0){b.forEach(function(a){var b=a.actualName,c=a.contactId,e=a.nickname,f=a.profilePictureUrl;a=a.secondaryName;var g=null;a!=null&&d("MWChatComposerMentionsUtils").doesParticipantNameMatch(a,m)?g="secondaryName":d("MWChatComposerMentionsUtils").doesParticipantNameMatch(b,m)?g="name":e!=null&&d("MWChatComposerMentionsUtils").doesParticipantNameMatch(e,m)&&(g="nickname");if(g!=null&&f!=null){var h;n.push({decorType:"regular",handle:(h=a)!=null?h:g==="nickname"?(h=e)!=null?h:b:b,key:c+" "+g,label:b,rawData:{photoURI:f,source:g,subtitle:(h=a)!=null?h:e},type:"entry"})}});if(c("gkx")("24051")){g=h._(/*BTDS*/"__JHASH__sTLNkkV9rF7__JHASH__").toString();if(d("MWChatComposerMentionsUtils").doesParticipantNameMatch(g,m)){i=h._(/*BTDS*/"__JHASH__rLeo5-LqefI__JHASH__").toString();n.push({decorType:"regular",handle:g,key:""+e,label:g,rawData:{source:"all",subtitle:i},type:"entry"})}b=h._(/*BTDS*/"__JHASH__qb09B47tS-j__JHASH__").toString();if(d("MWChatComposerMentionsUtils").doesParticipantNameMatch(b,m)){g=h._(/*BTDS*/"__JHASH__Y9cD1qBx4DO__JHASH__").toString();n.push({decorType:"regular",handle:b,key:e+"-active",label:b,rawData:{source:"all",subtitle:g},type:"entry"})}}}n.length>l&&(n=n.slice(0,l));n.length<l&&f&&f(m,l-n.length);return{entries:n,params:a}}var l=(e={},e[j]="ai",e);function b(a){a=l[a];return a==null?"p":a}g.aiBotMentionsEntry=k;g.fetchCacheComposerMentionsTypeahead=a;g.commandToRangeType=b}),226);
__d("MessengerLexicalEntityTextNode",["Lexical","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}var d=a.prototype;d.getEntity=function(){throw c("unrecoverableViolation")("CometMessengerLexicalEntityTextNode does not implement getEntity","messenger_comet")};return a}(d("Lexical").TextNode);function a(a){return a instanceof h}g.MessengerLexicalEntityTextNode=h;g.isMessengerLexicalEntityTextNode=a}),98);
__d("MessengerLexicalActorNode",["MWChatComposerTypeaheadUtil","MessengerLexicalEntityTextNode","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=a.replace(" name","");a=a.replace(" nickname","");a=a.replace(" secondaryName","");return a}var i=function(b){babelHelpers.inheritsLoose(a,b);a.getType=function(){return"actor"};a.clone=function(b){return new a({id:b.__contactID,prefix:b.__prefix,text:c("gkx")("4839")?l(b.__text,b.__prefix):b.__text.slice(1)},b.__key)};a.importJSON=function(a){return j({id:a.id,prefix:a.prefix,text:a.text})};var e=a.prototype;e.exportJSON=function(){return babelHelpers["extends"]({},b.prototype.exportJSON.call(this),{id:this.__contactID,prefix:this.__prefix,text:c("gkx")("4839")?l(this.__text,this.__prefix):this.__text.slice(1),type:"actor"})};function a(a,d){var e=a.id,f=a.prefix;f=f===void 0?"@":f;a=a.text;a=b.call(this,c("gkx")("4839")?k(a,f):a.startsWith(f)?a:""+f+a,d)||this;a.__contactID=h(e);a.__prefix=f;return a}e.createDOM=function(a){a=b.prototype.createDOM.call(this,a);a.className="xv78j7m xt0e3qv x3jgonx";a.spellcheck=!1;return a};e.getEntity=function(){return{id:this.__contactID,isWeak:!1}};e.getRangeType=function(){return d("MWChatComposerTypeaheadUtil").commandToRangeType(c("gkx")("4839")?l(this.__text,this.__prefix):this.__text.slice(1))};return a}(d("MessengerLexicalEntityTextNode").MessengerLexicalEntityTextNode);function j(a,b){b===void 0&&(b="segmented");return new i(a).setMode(b).toggleDirectionless()}function a(a){return a instanceof i}function k(a,b){return a.startsWith(b)?a:""+b+a}function l(a,b){return a.startsWith(b)?a.slice(b.length):a}g.MessengerLexicalActorNode=i;g.$createMessengerLexicalActorNode=j;g.$isMessengerLexicalActorNode=a}),98);
__d("messengerMentionsLexicalCreateNodeStrategy",["MessengerLexicalActorNode","cometBaseMentionsLexicalCreateNodeStrategy","cometMentionsDataEntryText"],(function(a,b,c,d,e,f,g){"use strict";a=c("cometBaseMentionsLexicalCreateNodeStrategy")(function(a){return d("MessengerLexicalActorNode").$createMessengerLexicalActorNode({id:a.key,text:c("cometMentionsDataEntryText")(a)})});b=a;g["default"]=b}),98);
__d("useCommunityMembers",["I64","Int64Hooks","LSClearCommunityMembersAndRangeStoredProcedure","LSFactory","LSIntEnum","LSIssueCommunityMemberListFetchStoredProcedure","LSVec","MWCMThreadTypes.react","ReQL","ReQLSuspense","asyncToGeneratorRuntime","promiseDone","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;(k||d("react")).useCallback;function a(a,e,g){var k=d("react-compiler-runtime").c(6),l=(h||(h=c("useReStore")))(),m,n;k[0]!==a||k[1]!==l||k[2]!==e||k[3]!==g?(m=function(){var h=function(){var h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield l.runInTransaction(function(b){return c("LSIssueCommunityMemberListFetchStoredProcedure")(c("LSFactory")(b),{communityId:a,fetchAdminsOnly:!1,fetchFriendMembersOnly:!1,maxName:"",maxTimestampMs:(i||(i=d("I64"))).zero,nextPageCursor:"",requestId:e,roles:c("LSVec").ofArray([(j||(j=d("LSIntEnum"))).ofNumber(0)]),source:j.ofNumber(13),threadKey:(b=g)!=null?b:void 0,threadRoles:c("LSVec").ofArray([])})},"readwrite",void 0,void 0,f.id+":44")});return function(){return h.apply(this,arguments)}}();c("promiseDone")(h())},n=[a,l,e,g],k[0]=a,k[1]=l,k[2]=e,k[3]=g,k[4]=m,k[5]=n):(m=k[4],n=k[5]);d("Int64Hooks").useEffectInt64(m,n)}function e(a,b,e){var g=d("react-compiler-runtime").c(10),i=(h||(h=c("useReStore")))(),j;g[0]!==a||g[1]!==i.tables.community_members_ranges_v2__generated||g[2]!==e||g[3]!==b?(j=function(){return d("ReQL").fromTableAscending(i.tables.community_members_ranges_v2__generated).getKeyRange(a).filter(function(a){if(a.requestId!==b)return!1;return e!=null?a.isAdmin===e:!0})},g[0]=a,g[1]=i.tables.community_members_ranges_v2__generated,g[2]=e,g[3]=b,g[4]=j):j=g[4];var k;g[5]!==a||g[6]!==i||g[7]!==e||g[8]!==b?(k=[i,a,e,b],g[5]=a,g[6]=i,g[7]=e,g[8]=b,g[9]=k):k=g[9];return d("ReQLSuspense").useFirst(j,k,f.id+":76")}function l(a){var b=d("react-compiler-runtime").c(3),e=a===void 0?7:a,g=(h||(h=c("useReStore")))();b[0]!==g||b[1]!==e?(a=function(a){return g.runInTransaction(function(b){return c("LSClearCommunityMembersAndRangeStoredProcedure")(c("LSFactory")(b),{requestId:a,source:(j||(j=d("LSIntEnum"))).ofNumber(e)})},"readwrite",void 0,void 0,f.id+":98")},b[0]=g,b[1]=e,b[2]=a):a=b[2];return a}function m(a){var e=d("react-compiler-runtime").c(12),g=a.communityIdOrThreadKey,k=a.thread,l=a.showAdmodsOnly,m=a.showHostsOnly,n=a.source,o=a.requestId,p=l===void 0?!1:l,q=m===void 0?!1:m;e[0]!==n?(a=n===void 0?(i||(i=d("I64"))).of_int32(7):n,e[0]=n,e[1]=a):a=e[1];var r=a,s=(h||(h=c("useReStore")))(),t=k.threadKey,u=k.threadType;e[2]!==g||e[3]!==s||e[4]!==o||e[5]!==p||e[6]!==q||e[7]!==r||e[8]!==t||e[9]!==u?(l=function(){var a=c("LSVec").ofArray(p?[(j||(j=d("LSIntEnum"))).ofNumber(1),(j||(j=d("LSIntEnum"))).ofNumber(2)]:q?[(j||(j=d("LSIntEnum"))).ofNumber(3)]:[(j||(j=d("LSIntEnum"))).ofNumber(0)]),e=d("MWCMThreadTypes.react").isBroadcastThread(u)?[(j||(j=d("LSIntEnum"))).ofNumber(0)]:[],h=function(){var h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield s.runInTransaction(function(b){return c("LSIssueCommunityMemberListFetchStoredProcedure")(c("LSFactory")(b),{communityId:g,fetchAdminsOnly:!1,fetchFriendMembersOnly:!1,maxName:"",maxTimestampMs:(i||(i=d("I64"))).zero,nextPageCursor:"",requestId:o,roles:a,source:r,threadKey:(i||(i=d("I64"))).equal(r,(i||(i=d("I64"))).of_int32(0))?void 0:t,threadRoles:c("LSVec").ofArray(e)})},"readwrite",void 0,void 0,f.id+":149")});return function(){return h.apply(this,arguments)}}();c("promiseDone")(h())},m=[s,g,t,u,p,r,o,q],e[2]=g,e[3]=s,e[4]=o,e[5]=p,e[6]=q,e[7]=r,e[8]=t,e[9]=u,e[10]=l,e[11]=m):(l=e[10],m=e[11]);d("Int64Hooks").useEffectInt64(l,m)}g.useFetchBannedMemberList=a;g.useCommunityMembersRanges=e;g.useClearMemberList=l;g.useFetchCommunityMembers=m}),98);
__d("createCometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport",["createCometMentionMatchStrategy","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=["@","\\uff20"].join(""),i=",\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'\"~=<>:;",j="(?:\\.[ |$]|[ ]['\"]|['\"][ |$]| |["+i+"]|)";function a(a){var b=a.disallowedTerms;a=a.minMatchLength;return c("createCometMentionMatchStrategy")({disallowedChars:i,disallowedTerms:b,minMatchLength:a,name:"CometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport("+a.toString()+")",triggers:h,validJoins:c("gkx")("4839")?j:void 0})}g["default"]=a}),98);
__d("useMWCMMentionsDataSourceResolverConfig",["I64","Int64Hooks","LSClearCommunityMembersAndRangeStoredProcedure","LSFactory","LSIssueCommunityMemberListFetchStoredProcedure","LSVec","Promise","asyncToGeneratorRuntime","createCometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport","pageID","promiseDone","react","react-compiler-runtime","useCometMentionsDataSourceResolverConfig","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;e=k||d("react");e.useMemo;var l=e.useRef;function a(a,e,g){var k=d("react-compiler-runtime").c(12),o=(i||(i=c("useReStore")))(),p=l(null),q;k[0]===Symbol["for"]("react.memo_cache_sentinel")?(q=[],k[0]=q):q=k[0];var r=l(q),s;k[1]!==o||k[2]!==a||k[3]!==e?(q=function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield o.runInTransaction(n,"readwrite",void 0,void 0,f.id+":51"),yield o.runInTransaction(function(f){return c("LSIssueCommunityMemberListFetchStoredProcedure")(c("LSFactory")(f),{communityId:a,fetchAdminsOnly:!1,fetchFriendMembersOnly:!1,maxName:"",maxTimestampMs:(j||(j=d("I64"))).zero,nextPageCursor:"",requestId:c("pageID"),roles:c("LSVec").ofArray([j.of_int32(0)]),searchText:b,source:j.of_int32(8),threadKey:e,threadRoles:c("LSVec").ofArray([])})},"readwrite",void 0,void 0,f.id+":59")});return function(a){return g.apply(this,arguments)}}(),s=[o,a,e],k[1]=o,k[2]=a,k[3]=e,k[4]=q,k[5]=s):(q=k[4],s=k[5]);var t=d("Int64Hooks").useCallbackInt64(q,s);k[6]!==g||k[7]!==t?(q={bootstrap:function(){},fetchCache:m,fetchNetwork:function(a){return new(h||(h=b("Promise")))(function(b){(a.query!==p.current||a.query===""&&p.current!=="")&&(p.current=a.query,c("promiseDone")(t(p.current))),g.length!==0&&(r.current=g),b({entries:g.length===0?r.current:g,params:a})})}},k[6]=g,k[7]=t,k[8]=q):q=k[8];k[9]===Symbol["for"]("react.memo_cache_sentinel")?(s=c("createCometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport")({minMatchLength:0}),k[9]=s):s=k[9];k[10]!==q?(s=[{dataSource:q,matchStrategy:s}],k[10]=q,k[11]=s):s=k[11];q=s;k=q;return c("useCometMentionsDataSourceResolverConfig")(k,!1)}function m(){return{entries:[],params:{query:""}}}function n(a){return c("LSClearCommunityMembersAndRangeStoredProcedure")(c("LSFactory")(a),{requestId:c("pageID"),source:(j||(j=d("I64"))).of_int32(8)})}g["default"]=a}),98);
__d("MWCMMentionsComposerPluginCreatorWithTypeaheadViewForLexical.react",["CometMentionsForLexical.react","CometMentionsLayoutStrategy.react","I64","MWChatComposerMentionsViewItem.react","ReQL","ReQLSuspense","messengerMentionsLexicalCreateNodeStrategy","pageID","promiseDone","react","react-compiler-runtime","useCometTypeaheadViewListStrategy","useCommunityMembers","useMWCMMentionsDataSourceResolverConfig","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=j||(j=d("react")),l=j.useEffect,m={view:{minWidth:"x1jzhcrs",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(19),e=a.editor,g=a.fbGroupId,j=a.folderId;a=a.threadFBID;var o=(h||(h=c("useReStore")))(),p;b[0]!==o.tables.community_members||b[1]!==o.tables.contextual_profile_v1||b[2]!==g||b[3]!==j?(p=function(){return d("ReQL").fromTableAscending(o.tables.community_members.index("communitySource")).getKeyRange(g,(i||(i=d("I64"))).of_int32(8),c("pageID")).filter(n).take(6).map(function(a){var b,c;b=(b=d("ReQLSuspense").first(d("ReQL").fromTableAscending(o.tables.contextual_profile_v1).getKeyRange(a.contactId,j),f.id+":60"))==null?void 0:b.profileName;return{key:(i||(i=d("I64"))).to_string(a.contactId),label:(c=b)!=null?c:a.name,rawData:{photoURI:a.profilePictureUrl,source:"all",subtitle:b!=null?a.name:a.subtitle},type:"entry"}})},b[0]=o.tables.community_members,b[1]=o.tables.contextual_profile_v1,b[2]=g,b[3]=j,b[4]=p):p=b[4];var q;b[5]!==o||b[6]!==g||b[7]!==j?(q=[o,g,j],b[5]=o,b[6]=g,b[7]=j,b[8]=q):q=b[8];p=d("ReQLSuspense").useArray(p,q,f.id+":48");b[9]!==a?(q=(i||(i=d("I64"))).of_string(a),b[9]=a,b[10]=q):q=b[10];a=c("useMWCMMentionsDataSourceResolverConfig")(g,q,p);b[11]===Symbol["for"]("react.memo_cache_sentinel")?(q={viewItemStrategyRenderer:c("MWChatComposerMentionsViewItem.react"),viewXStyle:m.view},b[11]=q):q=b[11];p=c("useCometTypeaheadViewListStrategy")(q);var r=d("useCommunityMembers").useClearMemberList(8),s;b[12]!==r?(q=function(){return function(){c("promiseDone")(r(c("pageID")))}},s=[r],b[12]=r,b[13]=q,b[14]=s):(q=b[13],s=b[14]);l(q,s);b[15]!==a||b[16]!==e||b[17]!==p?(q=k.jsx(c("CometMentionsForLexical.react"),{createNodeStrategy:c("messengerMentionsLexicalCreateNodeStrategy"),dataSourceResolverConfig:a,editor:e,layoutStrategyRenderer:c("CometMentionsLayoutStrategy.react"),position:"above",viewStrategyRenderer:p}),b[15]=a,b[16]=e,b[17]=p,b[18]=q):q=b[18];return q}function n(a){a=a.isBlocked;return a!==!0}g["default"]=a}),98);
__d("MWChatAppendMentionsNodeToReply",["I64","LSContactTypeExact","LSIntEnum","Lexical","LexicalText","MWChatComposerTypeaheadUtil","MWPReplyContext.react","MessengerLexicalActorNode","ReQL","ReQLSuspense","cometMentionsDataEntryText","react","react-compiler-runtime","usePrevious","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useContext,m=b.useEffect;function n(a,b){a.update(function(){var e=d("Lexical").$getSelection();if(!d("Lexical").$isRangeSelection(e)||!e.isCollapsed())return;var f=e.anchor;f=f.getNode();var g=c("cometMentionsDataEntryText")(b),h=d("Lexical").$getRoot().getAllTextNodes().some(function(a){return d("MessengerLexicalActorNode").$isMessengerLexicalActorNode(a)&&a.getTextContent().includes(g)});if(h===!0)return;h=d("MessengerLexicalActorNode").$createMessengerLexicalActorNode({id:b.key,text:g});var i=d("LexicalText").$isRootTextContentEmpty(a.isComposing());i?e.insertNodes([h]):f.insertBefore(h);h.selectNext(0,0)})}function a(a,b,e){var g=d("react-compiler-runtime").c(18),k=l(d("MWPReplyContext.react").MWPReplyContext),o=k.reply,p=c("usePrevious")(o),q=(h||(h=c("useReStore")))(),r;g[0]!==q||g[1]!==o||g[2]!==b?(k=function(){return o!=null?d("ReQL").fromTableAscending(q.tables.messages).getKeyRange(b,o.timestampMs,o.messageId):d("ReQL").empty()},r=[o,b,q],g[0]=q,g[1]=o,g[2]=b,g[3]=k,g[4]=r):(k=g[3],r=g[4]);var s=d("ReQLSuspense").useFirst(k,r,f.id+":91");g[5]!==q||g[6]!==s?(k=function(){return s!=null?d("ReQL").fromTableAscending(q.tables.contacts).getKeyRange(s.senderId):d("ReQL").empty()},r=[q,s],g[5]=q,g[6]=s,g[7]=k,g[8]=r):(k=g[7],r=g[8]);k=d("ReQLSuspense").useFirst(k,r,f.id+":102");g[9]!==k?(r=k!=null?(i||(i=d("I64"))).equal(k.contactTypeExact,(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactTypeExact").GENERATIVE_AI_BOT)):!1,g[9]=k,g[10]=r):r=g[10];k=r;var t=k&&(s==null?void 0:s.botResponseId)!=null;g[11]!==a||g[12]!==t||g[13]!==p||g[14]!==o||g[15]!==e?(r=function(){var b=p==null&&o!=null;b&&t&&e===!0&&n(a,d("MWChatComposerTypeaheadUtil").aiBotMentionsEntry)},k=[a,o,p,t,e],g[11]=a,g[12]=t,g[13]=p,g[14]=o,g[15]=e,g[16]=r,g[17]=k):(r=g[16],k=g[17]);m(r,k)}g.insertMentionNodeToFront=n;g.useMWChatAppendMentionsNodeToReply=a}),98);
__d("MWChatComposerMentionsTypeaheadDataSource",["CurrentUser","MWChatComposerTypeaheadUtil","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i=6;a=function(){function a(a,b,d,e,f){this.$1=[];this.$1=Array.from(a.values()).filter(function(a){return a.contactId!==c("CurrentUser").getID()});this.$2=b;this.$3=(a=d)!=null?a:null;this.$4=e;this.$5=f}var e=a.prototype;e.bootstrap=function(){return};e.fetchCache=function(a){return d("MWChatComposerTypeaheadUtil").fetchCacheComposerMentionsTypeahead(a,this.$1,this.$2,this.$3,this.$4,this.$5,i)};e.fetchNetwork=function(a){return(h||(h=b("Promise"))).resolve(this.fetchCache(a))};return a}();g["default"]=a}),98);
__d("MWChatForwardDialogQuery$Parameters",["MWChatForwardDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("MWChatForwardDialogQuery_facebookRelayOperation"),metadata:{},name:"MWChatForwardDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MWChatForwardDialog.entrypoint",["JSResourceForInteraction","MWChatForwardDialogQuery$Parameters","MWXacGating","WebPixelRatio"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(a){return{queries:{forwardQueryReference:{parameters:b("MWChatForwardDialogQuery$Parameters"),variables:{scale:d("WebPixelRatio").get(),suppress_xac_groups:!d("MWXacGating").isGroupsEnabled()}}}}},root:c("JSResourceForInteraction")("MWChatForwardDialog.react").__setRef("MWChatForwardDialog.entrypoint")};g["default"]=a}),98);
__d("useGetForwardSource",["LSIntEnum","LSMessagingThreadAttributionType","MWLSThreadDisplayContext","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=d("react-compiler-runtime").c(4),b=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext();if(b!=null)if(b==="Inbox"){var e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").MESSENGER_INBOX_FORWARD),a[0]=e):e=a[0];return e}else if(b==="ChatTab"){a[1]===Symbol["for"]("react.memo_cache_sentinel")?(e=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").MESSENGER_CHAT_FORWARD),a[1]=e):e=a[1];return e}else{a[2]===Symbol["for"]("react.memo_cache_sentinel")?(b=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").MESSENGER_BROADCAST_FLOW),a[2]=b):b=a[2];return b}else{a[3]===Symbol["for"]("react.memo_cache_sentinel")?(e=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").MESSENGER_BROADCAST_FLOW),a[3]=e):e=a[3];return e}}g["default"]=a}),98);
__d("useLSMessagingInitiatingSource",["LSIntEnum","LSMessagingInitiatingSource","MWLSThreadDisplayContext","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=d("react-compiler-runtime").c(4),b=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext();if(b==null)return;else if(b==="Inbox"){var e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingInitiatingSource").FACEBOOK_INBOX),a[0]=e):e=a[0];return e}else if(b==="FullscreenChat"){a[1]===Symbol["for"]("react.memo_cache_sentinel")?(e=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingInitiatingSource").FACEBOOK_FULLSCREEN),a[1]=e):e=a[1];return e}else if(b==="ChatTab"){a[2]===Symbol["for"]("react.memo_cache_sentinel")?(e=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingInitiatingSource").FACEBOOK_CHAT),a[2]=e):e=a[2];return e}else{a[3]===Symbol["for"]("react.memo_cache_sentinel")?(b=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingInitiatingSource").ROOMS_SIDE_CHAT),a[3]=b):b=a[3];return b}}g["default"]=a}),98);
__d("MessagePowerUp",[],(function(a,b,c,d,e,f){a=Object.freeze({AVATAR_LOVE:1e3,AVATAR_ANGER:1001,AVATAR_LAUGH:1002,AVATAR_CRY:1003,NONE:0,LOVE:1,GIFT_WRAP:2,CELEBRATION:3,FIRE:4,HALLOWEEN:5,NOM_NOM_DASH:6,NEW_YEARS:7});f["default"]=a}),66);
__d("WorkChatMessageType",[],(function(a,b,c,d,e,f){"use strict";a="text";b="gif";c="sticker";d="audio";e="file";f.text=a;f.gif=b;f.sticker=c;f.audio=d;f.file=e}),66);
__d("useMWLSSendStickerMessage",["I64","Int64Hooks","LSFactory","LSIntEnum","LSMailboxType","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSOptimisticSendMessageV2StoredProcedure","LSShape","LSThreadAttributionTypeUtil","MWPActor.react","MessagePowerUp","WorkChatMessageType","promiseDone","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b,e){var g=d("react-compiler-runtime").c(7),k=(j||(j=c("useReStore")))(),l=d("MWPActor.react").useActor(),m,n;g[0]!==l||g[1]!==b||g[2]!==a||g[3]!==e||g[4]!==k?(m=function(g,j,m){c("promiseDone")(k.runInTransaction(function(e){var f;f=d("LSThreadAttributionTypeUtil").getSource(g,(f=a)!=null?f:"unknown");return c("LSOptimisticSendMessageV2StoredProcedure")(c("LSFactory")(e),{extraSendMessageParams:d("LSShape").ofRecord({calculate_denormalizations:!0,initiating_source:b,mark_read:!0,optimistic_attachment_preview:d("LSShape").ofRecord({playable_url:void 0,playable_url_expiration_timestamp_ms:void 0,playable_url_fallback:void 0,playable_url_mime_type:void 0,preview_height:(h||(h=d("I64"))).zero,preview_url:m,preview_url_expiration_timestamp_ms:void 0,preview_url_fallback:void 0,preview_url_mime_type:void 0,preview_width:h.zero}),power_up_style:(i||(i=d("LSIntEnum"))).ofNumber(c("MessagePowerUp").NONE),reply_source_id:void 0,reply_source_type:i.ofNumber(c("LSMessageReplySourceType").MESSAGE),reply_source_type_v2:i.ofNumber(c("LSMessageReplySourceTypeV2").MESSAGE),snippet_has_emoji:!1,source:f,sticker_id:h.of_string(j)}),mailboxType:i.ofNumber(c("LSMailboxType").MESSENGER),senderId:l,threadKey:g,threadType:i.ofNumber(1)})},"readwrite",void 0,void 0,f.id+":49").then(function(a){e==null?void 0:e(d("WorkChatMessageType").sticker,1,a[0])}))},n=[k,l,b,a,e],g[0]=l,g[1]=b,g[2]=a,g[3]=e,g[4]=k,g[5]=m,g[6]=n):(m=g[5],n=g[6]);return d("Int64Hooks").useCallbackInt64(m,n)}g["default"]=a}),98);
__d("MWLSForwardMessage",["I64","Int64Hooks","LSFactory","LSMediaUrlAttachment","LSOptimisticSendAttachmentForwardStoredProcedure","LSOptimisticSendMessageForwardStoredProcedure","MWChatThreadId","MWPActor.react","ODS","Promise","ReQL","promiseDone","react-compiler-runtime","useGetForwardSource","useLSMessagingInitiatingSource","useLSMessagingSource","useMWLSSendStickerMessage","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(){var a=d("react-compiler-runtime").c(7),e=(k||(k=c("useReStore")))(),g=d("MWPActor.react").useActor(),o=c("useLSMessagingInitiatingSource")(),p=c("useGetForwardSource")(),q=c("useLSMessagingSource")(),r=c("useMWLSSendStickerMessage")(q,o),s;a[0]!==o||a[1]!==r||a[2]!==g||a[3]!==p||a[4]!==e?(q=function(a,k,q){if(q.type!=="sent")return;q=q.value;var s=q.timestamp,t=q.messageId,u=q.threadId;(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","send");var v=function(){return e.runInTransaction(function(b){return c("LSOptimisticSendMessageForwardStoredProcedure")(c("LSFactory")(b),{forwardedMsgId:t,forwardedMsgThreadKey:u,forwardedMsgTimestampMs:s,initiatingSource:o,senderId:g,source:p,threadKey:a,threadType:k})},"readwrite",void 0,void 0,f.id+":62").then(n)};c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.tables.messages).getKeyRange(u,s,t)).then(function(c){if(c==null)return v();var f=c.stickerId;if(f!=null)return d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.tables.attachments).getKeyRange(u,t)).then(function(c){c=c!=null?d("LSMediaUrlAttachment").previewUrl(c):void 0;r(a,(j||(j=d("I64"))).to_string(f),c);return(h||(h=b("Promise"))).resolve()});else return v()}),m,l)},s=[e,g,o,p,r],a[0]=o,a[1]=r,a[2]=g,a[3]=p,a[4]=e,a[5]=q,a[6]=s):(q=a[5],s=a[6]);return d("Int64Hooks").useCallbackInt64(q,s)}function l(){return(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","failure")}function m(){return(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","success")}function n(){}function e(){var a=d("react-compiler-runtime").c(6),b=(k||(k=c("useReStore")))(),e=d("MWPActor.react").useActor(),g=c("useLSMessagingInitiatingSource")(),h=c("useGetForwardSource")(),l,m;a[0]!==g||a[1]!==e||a[2]!==h||a[3]!==b?(l=function(){return function(a,k,l){(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","send");var m=d("MWChatThreadId").getMessagingThreadType(a),n=d("MWChatThreadId").toThreadKey(a);c("promiseDone")(b.runInTransaction(function(a){return c("LSOptimisticSendAttachmentForwardStoredProcedure")(c("LSFactory")(a),{forwardedAttachmentFbid:(j||(j=d("I64"))).of_string(k),initiatingSource:g,senderId:e,source:h,threadKey:n,threadType:m})},"readwrite",void 0,void 0,f.id+":140"),p,o)}},m=[b,e,g,h],a[0]=g,a[1]=e,a[2]=h,a[3]=b,a[4]=l,a[5]=m):(l=a[4],m=a[5]);return d("Int64Hooks").useMemoInt64(l,m)}function o(){return(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","failure")}function p(){return(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","success")}g.useForwardMessage=a;g.useForwardAttachment=e}),98);
__d("getMessengerPreciseTimestamp",["$InternalEnum","formatDate"],(function(a,b,c,d,e,f,g){"use strict";var h=b("$InternalEnum").Mirrored(["TODAY","WEEK_AGO","CURRENT_YEAR","OTHER_YEAR"]);d=864e5;var i=6*d;function j(a){a=new Date(a);var b=new Date();b=new Date(b.getFullYear(),b.getMonth(),b.getDate());if(b<a)return h.TODAY;if(b.getTime()-i<a.getTime())return h.WEEK_AGO;return b.getFullYear()===a.getFullYear()?h.CURRENT_YEAR:h.OTHER_YEAR}function k(a){a=j(a);switch(a){case h.TODAY:return"g:ia";case h.WEEK_AGO:return"l g:ia";case h.CURRENT_YEAR:return"F jS, g:ia";case h.OTHER_YEAR:return"F j, Y g:i a"}}function a(a){return c("formatDate")(new Date(a),k(a))}g["default"]=a}),98);
__d("MWMessageDeliveryStatus",["fbt","I64","LSIntEnum","getFBTSafeGenderFromGenderConst","getMessengerPreciseTimestamp","intlList","intlSummarizeNumber"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;function a(a){if(a.length!==1)return{heads:a,type:"MultipleSeenHeads"};a=a[0];return{head:a,type:"SingleSeenHead"}}function b(a,b){return{delivered:b,heads:a,type:"DeliveredAndRead"}}function e(a){return{count:a,type:"SeenCount"}}function k(a){return a.timestamp>0?h._(/*BTDS*/"__JHASH__i65FoHjBJBT__JHASH__",[h._name("full name",a.name,c("getFBTSafeGenderFromGenderConst")(a.gender)),h._param("seen time",c("getMessengerPreciseTimestamp")(a.timestamp))]):h._(/*BTDS*/"__JHASH__o0y2JESDXU1__JHASH__",[h._name("full name",a.name,c("getFBTSafeGenderFromGenderConst")(a.gender))])}function l(a,b){if(a.length===0)return"";if(b)return h._(/*BTDS*/"__JHASH__xJFzJjmgrii__JHASH__").toString();b=a.map(function(a){return h._(/*BTDS*/"__JHASH__anoMlIo0TA0__JHASH__",[h._name("full name",a.name,c("getFBTSafeGenderFromGenderConst")(a.gender))])});a=c("intlList")(b,c("intlList").CONJUNCTIONS.AND,c("intlList").DELIMITERS.COMMA);return h._(/*BTDS*/"__JHASH__rtgGiNEWfHK__JHASH__",[h._param("full name",a)]).toString()}function m(a){a=c("intlSummarizeNumber")(a);return h._(/*BTDS*/"__JHASH___KIWePVuuHb__JHASH__",[h._param("seen count",a)]).toString()}var n={delivered:h._(/*BTDS*/"__JHASH__DGTdcv4yxEO__JHASH__"),error:h._(/*BTDS*/"__JHASH__HWY7OcPbAjW__JHASH__"),loading:h._(/*BTDS*/"__JHASH__ge1hq8iGlfw__JHASH__"),retriableError:h._(/*BTDS*/"__JHASH__VG5ajSXV9DG__JHASH__"),sending:h._(/*BTDS*/"__JHASH__-KPam8KdjJ8__JHASH__"),sent:h._(/*BTDS*/"__JHASH__FdnMQ3ayYbi__JHASH__")};function f(a){switch(a.type){case"Sending":return n.sending;case"Sent":case"Delivered":return n.sent;case"Error":return n.error;case"SingleSeenHead":return k(a.head);case"NoneStatus":case"MultipleSeenHeads":return"";case"DeliveredAndRead":return l(a.heads,a.delivered);case"SeenCount":return m(a.count);case"Loading":return n.loading;case"RetriableError":return n.retriableError;case"ValidationError":return""}}function o(a){switch(a.type){case"Sending":return n.sending;case"Sent":return n.sent;case"Delivered":return n.delivered;case"Error":case"RetriableError":return n.error;case"SingleSeenHead":return k(a.head);case"DeliveredAndRead":return l(a.heads,a.delivered);default:return""}}function p(a){if((i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(1)))return{type:"Sending"};else if((i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(2))||(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(6)))return{type:"Sent"};else if((i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(4))||(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(5)))return{type:"Error"};else return{type:"NoneStatus"}}function q(a,b,c){var e=p(a.sendStatusV2);if((i||(i=d("I64"))).equal(a.sendStatusV2,(j||(j=d("LSIntEnum"))).ofNumber(4))||(i||(i=d("I64"))).equal(a.sendStatusV2,(j||(j=d("LSIntEnum"))).ofNumber(5))||(i||(i=d("I64"))).equal(a.sendStatusV2,(j||(j=d("LSIntEnum"))).ofNumber(1)))return e;else if(!c&&(i||(i=d("I64"))).equal(a.sendStatusV2,(j||(j=d("LSIntEnum"))).ofNumber(2)))return{type:"NoneStatus"};else if((i||(i=d("I64"))).ge(b,a.timestampMs))return{type:"Delivered"};else return e}function r(a){return["SingleSeenHead","Sending","MultipleSeenHeads","Error","RetriableError"].includes(a.type)}g.seenHead=a;g.deliveredAndRead=b;g.seenCount=e;g.getSingleSeenHead=k;g.getSeenCount=m;g.Titles=n;g.getBroadcastStatusTitle=f;g.getStatusTitle=o;g.getFromSendStatus=p;g.getDeliveryStatusForMessageSentByYou=q;g.isAlwaysShownStatus=r}),226);
__d("MWPComposerMediaUploadUtil",["FBLogger","I64","LSGetAttachmentType","LSIntEnum","MessagingAttachmentType","Promise","ResumableUploadServiceState.enum","URI","asyncToGeneratorRuntime","cr:6057","cr:7187","emptyFunction","promiseDone","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l="messenger_file",m="messenger_audio",n="messenger_image",o="messenger_video",p="file_type",q="image_type",r="video_type",s="audio_type",t="FILE_ATTACHMENT",u="VOICE_MESSAGE",v="target_id";function w(a,b,c,d,e,f,g,h,i,j,k){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d,e,f,g,h,i,j,k,l,m){d===void 0&&(d=c("emptyFunction"));f===void 0&&(f=c("emptyFunction"));g===void 0&&(g=!1);var n="/ajax/mercury/upload.php";j===!0&&(n="/ajax/mercury/chatsupportuser/upload.php");var o=(yield b("cr:6057").load());o=new o({concurrentLimit:3,onUploadFailure:f,onUploadProgress:d,onUploadStart:function(b,c){a&&a(b,c.upload._file.size,c.upload._file.type)},onUploadSuccess:function(a,b){b=b.response.payload.metadata;var d;if(b==null)c("FBLogger")("messenger_web_media").warn("Empty payload"),d={};else{b=b[0];b!=null?d=b:(c("FBLogger")("messenger_web_media").warn("Empty metadata isChatSupportUser: %s",j),d={})}b=d.fbid;var f=d.video_id,g=d.audio_id,h=d.gif_id;d=d.file_id;g=(b=(f=(b=(b=b)!=null?b:f)!=null?b:g)!=null?f:h)!=null?b:d;typeof g==="number"&&(g=g.toString());z(g);e(a,g);if(g==null)throw c("unrecoverableViolation")("Unrecognized file upload success payload","messenger_web_media")},retryLimit:1,uploadEndpoint:n});f={};f.data={chat_support_user_id:j===!0&&k!=null?k:void 0,nonce:j===!0&&m!=null?m:void 0,voice_clip:g?!0:void 0,voice_clip_waveform_data:g?JSON.stringify(l):void 0};o.getAsyncFileUploadRequest(h,i,f).send()});return x.apply(this,arguments)}function y(a,e,f,g,h,i){f===void 0&&(f=c("emptyFunction"));if(!b("cr:7187"))return;var w=(k||(k=c("URI"))).getRequestURI().getDomain(),x=/workplace.com/i.test(w)?"workplace.com":/messenger.com/i.test(w)?"messenger.com":"facebook.com";g.forEach(function(g,k){var w=g.attachmentType,y=g.file;g=l;var z=p,A=t;switch(w){case(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE):g=n;z=q;break;case(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO):g=m;z=s;A=u;break;case(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO):g=o;z=r;break;default:break}w=b("cr:7187").create({consumer:g,customHttpHeaders:new Map([[v,i],[z,A]]),serviceDomain:x});w.addListener((g=c("ResumableUploadServiceState.enum")).START,function(){a&&a(h[k],y.size,y.type)});w.addListener(g.SUCCESS,function(a){e(h[k],a.media_id)});w.addListener(g.FAIL,function(a){f(h[k],{response:a})});w.addListener(g.TRANSPORT_FAILURE,function(a){f(h[k],{response:a})});void w.resume(y)})}function z(a){if(a!=null){var b=Number(a),d=b.toString();b>Number.MAX_SAFE_INTEGER&&d!==a&&c("FBLogger")("work_web_messaging","messaging-composer-upload-fbid-out-of-range").warn("FBID for attachment is out of JS Number range and it's not correctly handled on client: %d",a)}}function a(a,b,c,d,e,f,g,h,i,j,k,l){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,k,l,m,n,o,p,q,r){e===void 0&&(e=c("emptyFunction"));g===void 0&&(g=c("emptyFunction"));k===void 0&&(k=!1);if(b("cr:7187")&&r!=null&&n!==!0){var s=[],t=[],u=[],v=[],x=(yield (h||(h=b("Promise"))).all(l.map(function(a){return d("LSGetAttachmentType").LSGetAttachmentType(a)})));l.forEach(function(a,b){var e=x[b];(i||(i=d("I64"))).equal(e,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))?(s.push({attachmentType:e,file:a}),t.push(m[b])):(u.push(a),v.push(m[b]))});s.length>0&&y(a,f,g,s,t,r);u.length>0&&c("promiseDone")(w(a,e,f,g,k,u,v,n,o,p,q))}else c("promiseDone")(w(a,e,f,g,k,l,m,n,o,p,q))});return A.apply(this,arguments)}function e(a,b,e,f){return{action_url:void 0,attachment_fbid:a,attachment_index:(i||(i=d("I64"))).zero,attachment_type:(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO),cta1_title:void 0,cta2_title:void 0,cta3_title:void 0,description_text:void 0,filename:void 0,filesize:void 0,has_media:!0,has_xma:!1,image_url:void 0,mini_preview:void 0,offline_attachment_id:a,original_file_hash:void 0,playable_duration_ms:i.of_float(e*1e3),playable_url:URL.createObjectURL(b),playable_url_mime_type:b.type,preview_height:void 0,preview_url:void 0,preview_url_mime_type:void 0,preview_width:void 0,sampling_frequency_hz:f==null?void 0:f.sampling_freq,source_text:void 0,subtitle_text:void 0,title_text:void 0,waveform_data:f==null?void 0:(a=f.amplitudes)==null?void 0:a.join(","),xma_layout_type:void 0,xmas_template_type:void 0}}function f(a,b){a=a.map(function(a){return{action_url:void 0,attachment_fbid:a.offlineAttachmentId,attachment_index:(i||(i=d("I64"))).zero,attachment_type:a.attachmentType,cta1_title:void 0,cta2_title:void 0,cta3_title:void 0,description_text:void 0,filename:a.filename,filesize:void 0,has_media:!0,has_xma:!1,image_url:void 0,mini_preview:void 0,offline_attachment_id:a.offlineAttachmentId,original_file_hash:void 0,playable_duration_ms:void 0,playable_url:a.previewUrl,playable_url_mime_type:a.mimeType,preview_height:a.previewHeight,preview_url:a.previewUrl,preview_url_mime_type:void 0,preview_width:a.previewWidth,source_text:void 0,subtitle_text:void 0,title_text:void 0,xma_layout_type:void 0,xmas_template_type:void 0}});var e=[],f=[];a.forEach(function(a){(i||(i=d("I64"))).equal(a.attachment_type,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))&&!b?f.push(a):e.push([a])});f.length>0&&e.unshift(f);return e.map(function(a){return a.map(function(a,b){return babelHelpers["extends"]({},a,{attachment_index:(i||(i=d("I64"))).of_int32(b)})})})}g.startUpload=a;g.getAudioAttachment=e;g.createPartitionedAttachments=f}),98);
__d("MWPOpenComposerUtils",["I64","LSRemoveMediaSendJobsStoredProcedure","LSResumeMediaSendJobStoredProcedure","MWConsole","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){return a.media_staging.get(c).then(function(d){if(d!=null)return a.media_staging["delete"](c);else return(i||(i=b("Promise"))).resolve()})}function e(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=(yield a.media_staging.get(b));b!=null&&(yield a.media_staging.put(c(b)))});return j.apply(this,arguments)}function f(a,c,d,e,f){return a.attachments.get(c,d,e).then(function(g){if(g!=null)return a.attachments.upsert([c,d,e],f(g));else return(i||(i=b("Promise"))).resolve()})}function k(a,e,f){return c("LSResumeMediaSendJobStoredProcedure")(a,{dataTraceId:(f=f)!=null?f:void 0,jobId:e,pluginType:(h||(h=d("I64"))).zero}).then(function(d){var f=d[0],g=d[1];g=d[2];if(f)return c("LSRemoveMediaSendJobsStoredProcedure")(a,{offlineThreadingId:e});else return(i||(i=b("Promise"))).resolve()})}g.deleteMediaStaging=a;g.updateMediaStaging=e;g.updateAttachment=f;g.resumeSendJob=k}),98);
__d("MWPThreadCapabilitiesContext",["I64","Int64Hooks","LSIntEnum","LSMessageThreadUnsendabilityStatus","LSThreadBitOffset","ThreadStatus","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=h||(h=d("react"));e=h;f=e.createContext;var l=e.useContext,m=f({blurMediaEnabled:!1,canUnsendMessage:!1,communityMessagingChannelDescriptionCustomization:!1,communityMessagingChannelInvite:!1,disableLinks:!1,editMessageEnabled:!1,hasLSThreadBitOffset:function(a){return!1},isPaused:!1,localDeleteMessageEnabled:!1,messageForwardEnabled:!1,messageUnsendEnabled:!1,modifyPinnedMessageV2Enabled:!1,reactEnabled:!1,reactionsV2WriteEnabled:!1,replyEnabled:!1,reportMessageToAdminEnabled:!1,rtcVideoCallEnabled:!1,rtcVoiceCallEnabled:!1,seenCountV2Enabled:!1,subThreadCreationEnabled:!1});function a(a){var b=d("react-compiler-runtime").c(17),e=a.children,f=a.customCapabilityCheck,g=a.thread,h=g.capabilities,l=g.capabilities2,n=g.capabilities3,o=g.capabilities4,p=g.capabilities5,q=g.threadType,r;b[0]!==h||b[1]!==l||b[2]!==n||b[3]!==o||b[4]!==p||b[5]!==q?(a=function(a){var b={capabilities:h,capabilities2:l,capabilities3:n,capabilities4:o,capabilities5:p,threadType:q};return d("LSThreadBitOffset").has(a,b)},r=[h,l,n,o,p,q],b[0]=h,b[1]=l,b[2]=n,b[3]=o,b[4]=p,b[5]=q,b[6]=a,b[7]=r):(a=b[6],r=b[7]);var s=d("Int64Hooks").useCallbackInt64(a,r);b[8]!==f||b[9]!==s||b[10]!==g.cannotUnsendReason||b[11]!==g.threadStatus?(a=function(){var a;return{blurMediaEnabled:s(46),canUnsendMessage:g.cannotUnsendReason!=null?(i||(i=d("I64"))).equal(g.cannotUnsendReason,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageThreadUnsendabilityStatus").CAN_UNSEND)):!0,communityMessagingChannelDescriptionCustomization:s(135),communityMessagingChannelInvite:s(120),disableLinks:s(45),editMessageEnabled:s(194),hasLSThreadBitOffset:(a=s)!=null?a:f,isPaused:g.threadStatus!=null&&((i||(i=d("I64"))).equal(g.threadStatus,(i||(i=d("I64"))).of_int32(c("ThreadStatus").PAUSED))||(i||(i=d("I64"))).equal(g.threadStatus,(i||(i=d("I64"))).of_int32(c("ThreadStatus").PAUSED_AND_UPGRADED_TO_COMMUNITY))),localDeleteMessageEnabled:s(102),messageForwardEnabled:s(103),messageUnsendEnabled:s(122)&&g.cannotUnsendReason!=null?(i||(i=d("I64"))).equal(g.cannotUnsendReason,(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageThreadUnsendabilityStatus").CAN_UNSEND)):!1,modifyPinnedMessageV2Enabled:s(172),reactEnabled:s(18),reactionsV2WriteEnabled:s(169),replyEnabled:s(42),reportMessageToAdminEnabled:s(93),rtcVideoCallEnabled:s(24),rtcVoiceCallEnabled:s(25),seenCountV2Enabled:s(140),subThreadCreationEnabled:s(167)}},r=[f,s,g.threadStatus,g.cannotUnsendReason],b[8]=f,b[9]=s,b[10]=g.cannotUnsendReason,b[11]=g.threadStatus,b[12]=a,b[13]=r):(a=b[12],r=b[13]);a=d("Int64Hooks").useMemoInt64(a,r);b[14]!==e||b[15]!==a?(r=k.jsx(m.Provider,{value:a,children:e}),b[14]=e,b[15]=a,b[16]=r):r=b[16];return r}function b(){return l(m)}g.Provider=a;g.useMWPThreadCapabilitiesContext=b}),98);
__d("MWV2LogMessageClick",["I64","LSMessagingThreadTypeUtil","Promise","ReQL","UserAgentData","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LsMessageClickFalcoEvent").__setRef("MWV2LogMessageClick");function a(a,e,f,g){var k=e.threadKey;c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads).getKeyRange(k)).then(function(a){a!=null&&!d("LSMessagingThreadTypeUtil").isArmadilloSecure(a.threadType)&&j.onReady(function(a){a.log(function(){var a;return{click:{category:2},click_target:{type:f},extra:JSON.stringify({action:(a=g)!=null?a:void 0,browserName:c("UserAgentData").browserName}),message:{id:e.messageId,sender_id:void 0,sent_time:(i||(i=d("I64"))).to_float(e.timestampMs)},thread:{id:i.to_string(e.threadKey),key:void 0,type:void 0},xma:void 0}})});return(h||(h=b("Promise"))).resolve()}))}g.log=a}),98);
__d("MWV2OneToOneThreadBlockedContext.react",["react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));c=h;e=c.createContext;var j=c.useContext,k=e(!1);function a(){return j(k)}function b(a){var b=d("react-compiler-runtime").c(3),c=a.blocked;a=a.children;var e=k.Provider;b[0]!==c||b[1]!==a?(e=i.jsx(e,{value:c,children:a}),b[0]=c,b[1]=a,b[2]=e):e=b[2];return e}g.useIsBlocked=a;g.MWV2OneToOneThreadBlockedContext=b}),98);
__d("MWWorkForeignEntityTypeUtils",["I64","LSContactWorkForeignEntityType","LSIntEnum"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactWorkForeignEntityType").NOT_FOREIGN))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)))return"NOT_FOREIGN";else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactWorkForeignEntityType").NOT_FOREIGN_LIMITED)))return"LIMITED";else return"FOREIGN"}g.getWorkForeignEntityType=a}),98);
__d("MWXMAUtils",["I64","LSXmaContentType"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set(["xma_rtc_video","xma_rtc_missed_video","xma_rtc_missed_group_video","xma_rtc_ended_video","xma_rtc_new_video_default","xma_rtc_new_video_from_fb_share","xma_rtc_new_video_from_fb_video_share","xma_rtc_new_video_from_cowatch_share","xma_rtc_cowatch_start_video","xma_rtc_audio","xma_rtc_missed_audio","xma_rtc_missed_group_audio","xma_rtc_ended_audio","xma_rtc_new_audio_default","xma_rtc_new_audio_from_fb_share","xma_rtc_new_audio_from_fb_video_share","xma_rtc_new_audio_from_cowatch_share"]);function a(a){return i.has(a)}function b(a){var b;return(h||(h=d("I64"))).to_int32((b=a)!=null?b:(h||(h=d("I64"))).zero)===c("LSXmaContentType").MSG_LOCATION_SHARING||(h||(h=d("I64"))).to_int32((b=a)!=null?b:(h||(h=d("I64"))).zero)===c("LSXmaContentType").MSG_LOCATION_SHARING_V2}g.isRTCXMA=a;g.isLocationShareXMA=b}),98);
__d("OfflineThreadingId",["I64","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||(h=d("I64"))).of_string("4194303");function a(){return(h||(h=d("I64"))).to_string(j())}function j(){var a=d("XPlatReactCrypto").getRandomValues(new Uint8Array(8));a=new DataView(a.buffer);a=(h||(h=d("I64"))).add(h.lsl_(h.of_int32(a.getUint32(0)),32),h.of_int32(a.getUint32(4)));return k(Date.now(),a)}function k(a,b){return(h||(h=d("I64"))).and_(h.or_(h.lsl_(h.of_float(a),22),h.and_(b,i)),h.max_int)}function b(a){var b=j(),c=[];for(var e=0;e<a.length;e++)c.push([a[e],(h||(h=d("I64"))).to_string(b)]),b=l(b);return c}function l(a,b){b===void 0&&(b=(h||(h=d("I64"))).one);var c=m(a);a=n(a);return k(c,(h||(h=d("I64"))).add(a,b))}function m(a){return(h||(h=d("I64"))).to_float(h.lsr_(a,22))}function n(a){return(h||(h=d("I64"))).and_(a,i)}g.createOfflineThreadingID=a;g.createForItemsInOrder=b;g.extractTimestamp=m}),98);
__d("isDeliveryStatusErrorState",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.type==="Error"||a.type==="RetriableError"}f["default"]=a}),66);
__d("isReceiverFetchSticker",["I64","LSIntEnum","MessagingAttachmentType"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=a.attachmentType;b=(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").STICKER));a=a.receiverFetchId;return b&&a!=null}g["default"]=a}),98);
__d("shouldHideMessagingActions",["I64","LSIntEnum","isDeliveryStatusErrorState"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){return(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(256))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(65536))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(131072))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(262144))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(524288))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4294967296))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1048576))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2097152))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4194304))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(8388608))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16777216))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(67108864))||(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1073741824))}function a(a,b){return c("isDeliveryStatusErrorState")(b)||j(a)?!0:!1}g["default"]=a}),98);
__d("useMAWBulkMediaDownloadStatus",["I64","LSAuthorityLevel","LSIntEnum","MAWBridgeSendAndReceive","MAWDbMedia","MAWMediaDownloadStatus","MAWStateContext.react","MessagingAttachmentType","WAHashUtils","isReceiverFetchSticker","promiseDone","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=h||d("react");var k=b.useContext,l=b.useEffect;b.useMemo;var m=new Set();function a(a){var b=d("react-compiler-runtime").c(9),e=d("MAWStateContext.react").useMAWSelector(p),f=d("MAWStateContext.react").useMAWSelector(o);if(b[0]!==a||b[1]!==f||b[2]!==e){var g;b[4]!==f||b[5]!==e?(g=function(a,b){var g=a.attachment,h=a.mediaRenderQpl;a=a.statusKey;var k=c("isReceiverFetchSticker")(g),l=(i||(i=d("I64"))).equal(g.attachmentType,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA)),m=Object.prototype.hasOwnProperty.call(e,a),n=g.transportKey==="FBBroker"||g.transportKey==="FBLegacyBroker",o=!n&&(i||(i=d("I64"))).to_int32(g.authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC,p=o?{mainMediaStatus:c("MAWMediaDownloadStatus").SUCCESS,mainMediaStatusDetails:"optimistic_secure_upload",previewMediaStatus:c("MAWMediaDownloadStatus").SUCCESS,previewMediaStatusDetails:"optimistic_secure_upload"}:m?e[a]:null;return{attachmentsData:{attachment:g,hasStatus:m,isOpenThreadAttachment:n,isOptimisticSecureUpload:o,isReceiverFetch:k,isXMA:l,retryCount:(g=f[a])!=null?g:0,status:p,statusKey:a},index:b,mediaRenderQpl:h}},b[4]=f,b[5]=e,b[6]=g):g=b[6];g=a.map(g);b[0]=a;b[1]=f;b[2]=e;b[3]=g}else g=b[3];a=g;g=a;q(g);b[7]!==g?(a=g.map(n),b[7]=g,b[8]=a):a=b[8];g=a;return g}function n(a){a=a.attachmentsData;return a}function o(a){return a.mediaDownloadRetryCount}function p(a){return a.mediaDownloadStatus}function q(a){var b=d("react-compiler-runtime").c(4),e=k(d("MAWStateContext.react").MAWDispatchContext),f,g;b[0]!==a||b[1]!==e?(f=function(){a.forEach(function(a){var b=a.attachmentsData,f=a.index,g=a.mediaRenderQpl;a=b.hasStatus;var h=b.isOpenThreadAttachment,i=b.isOptimisticSecureUpload,j=b.isReceiverFetch,k=b.isXMA,l=b.statusKey;if(k||i||h||j||l==null||a||m.has(l))return;m.add(l);var n=isNaN(l);g==null?void 0:g.addPoint("fetch-initial-download-status-"+f+"-start",{string:{fetch_by:n?"plaintext_hash":"media_id"}});b=n?d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaDownloadStatusByPlaintextHash",{plaintextHash:d("WAHashUtils").stringToPlaintextHash(l),qplInstanceKey:g==null?void 0:g.getInstanceKey()}):d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaDownloadStatusByMediaId",{mediaId:d("MAWDbMedia").convertNumberToMediaId(parseInt(l,10)),qplInstanceKey:g==null?void 0:g.getInstanceKey()});c("promiseDone")(b.then(function(a){g==null?void 0:g.addPoint("fetch-initial-download-status-"+f+"-end",{bool:{has_result:a!=null},string:{fetch_by:n?"plaintext_hash":"media_id",main_media_status:r(a==null?void 0:a.mainMediaStatus),preview_media_status:r(a==null?void 0:a.previewMediaStatus)}}),a!=null&&e({tag:"SetMediaDownloadStatusState",value:{key:n?d("WAHashUtils").stringToPlaintextHash(l):d("MAWDbMedia").convertNumberToMediaId(parseInt(l,10)),newMediaDownloadState:a}})}))})},g=[e,a],b[0]=a,b[1]=e,b[2]=f,b[3]=g):(f=b[2],g=b[3]);l(f,g)}function r(a){if(a==null)return"UNKNOWN";switch(a){case c("MAWMediaDownloadStatus").DOWNLOADING:return"DOWNLOADING";case c("MAWMediaDownloadStatus").SUCCESS:return"SUCCESS";case c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE:return"NOT_MANUAL_RETRYABLE_FAILURE";case c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE:return"MANUAL_RETRYABLE_FAILURE";case c("MAWMediaDownloadStatus").MISSING_FILE:return"MISSING_FILE"}}g["default"]=a}),98);
__d("useMAWBulkMediaDownloadStatusUIStateNonDebounced",["I64","LSIntEnum","LSMediaUrlUtils","MAWLoggerUtils","MAWMediaDownloadStatus","MessagingAttachmentType","WATagsLogger","react","react-compiler-runtime","useMAWBulkMediaDownloadStatus"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["useMAWMediaDownloadStatusUIState: unexpected download status"]);k=function(){return a};return a}(h||d("react")).useMemo;var l=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload]),m=5;function a(a){var b=d("react-compiler-runtime").c(5),e=c("useMAWBulkMediaDownloadStatus")(a);if(b[0]!==e||b[1]!==a){var f;b[3]!==a?(f=function(b,e){var f,g=b.retryCount;b=b.status;f=(f=b)!=null?f:{};var h=f.mainMediaStatus;f=f.previewMediaStatus;e=a[e].attachment;if(e.receiverFetchId!=null&&d("LSMediaUrlUtils").hasValidReceiverFetchPreviewUrl(e.previewUrl,e.previewUrlExpirationTimestampMs))return"downloaded";g=g>=m;var i=b==null||h===c("MAWMediaDownloadStatus").DOWNLOADING||h===c("MAWMediaDownloadStatus").MISSING_FILE,j=h===c("MAWMediaDownloadStatus").SUCCESS,o=h===c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,p=o&&g;h=h===c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE;b=b==null||f===c("MAWMediaDownloadStatus").DOWNLOADING||f===c("MAWMediaDownloadStatus").MISSING_FILE||f===void 0&&i;var q=f===c("MAWMediaDownloadStatus").SUCCESS,r=f===c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE||f===void 0&&o;g=r&&g;f=f===c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE||f===void 0&&h;e=n(e);if(e&&!b){if(q||j){if(h||p)return"non_retryable_error_with_preview";else if(o)return"retryable_error_with_preview";return"downloaded"}else if(f||g)return"non_retryable_error";else if(r)return"retryable_error"}else if(j)return"downloaded";else if(h||p)return"non_retryable_error";else if(o)return"retryable_error";else if(i)return"loading";l.WARN(k());return"loading"},b[3]=a,b[4]=f):f=b[4];f=e.map(f);b[0]=e;b[1]=a;b[2]=f}else f=b[2];e=f;return e}function n(a){if(a==null)return!1;a=a.attachmentType;return(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))||(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))}g["default"]=a}),98);
__d("useMAWBulkMediaDownloadStatusUIStateDebounced",["clearTimeout","justknobx","react","react-compiler-runtime","setTimeout","useMAWBulkMediaDownloadStatusUIStateNonDebounced"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;var i=b.useEffect,j=b.useRef,k=b.useState;function a(a){var b=d("react-compiler-runtime").c(4),e=c("useMAWBulkMediaDownloadStatusUIStateNonDebounced")(a);a=m(e);var f=a[0],g=a[1],h;b[0]!==e||b[1]!==g?(a=function(){g(e,!e.some(l))},h=[e,g],b[0]=e,b[1]=g,b[2]=a,b[3]=h):(a=b[2],h=b[3]);i(a,h);return f}function l(a){return a==="loading"||a==="downloaded"}function m(a){var b=d("react-compiler-runtime").c(5),e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=c("justknobx")._("3145"),b[0]=e):e=b[0];var f=e;e=k(a);a=e[0];var g=e[1],h=j(null);b[1]===Symbol["for"]("react.memo_cache_sentinel")?(e=function(){c("clearTimeout")(h.current),h.current=null},b[1]=e):e=b[1];var i=e;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(e=function(a,b){i();if(!b){g(a);return}h.current=c("setTimeout")(function(){g(a)},f)},b[2]=e):e=b[2];e=e;b[3]!==a?(e=[a,e,i],b[3]=a,b[4]=e):e=b[4];return e}g["default"]=a}),98);
__d("useMAWBulkMediaDownloadStatusUIState",["useMAWBulkMediaDownloadStatusUIStateDebounced"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("useMAWBulkMediaDownloadStatusUIStateDebounced")(a)}g["default"]=a}),98);
__d("useMAWMediaDownloadStatusUIState",["react","react-compiler-runtime","useMAWBulkMediaDownloadStatusUIState"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b,e){var f=d("react-compiler-runtime").c(4);if(f[0]!==a||f[1]!==e||f[2]!==b){var g;g=a!=null?[{attachment:a,mediaRenderQpl:b,statusKey:(g=e)!=null?g:a.attachmentFbid}]:[];f[0]=a;f[1]=e;f[2]=b;f[3]=g}else g=f[3];a=g;e=a;b=c("useMAWBulkMediaDownloadStatusUIState")(e);return b.length>0?b[0]:null}g["default"]=a}),98);
__d("useMAWMediaStatusUIState",["react-compiler-runtime","useMAWMediaDownloadStatusUIState","useMAWMediaValidationResultState"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=d("react-compiler-runtime").c(3),g=c("useMAWMediaDownloadStatusUIState")(a,b,e);a=c("useMAWMediaValidationResultState")(a,b,e);f[0]!==g||f[1]!==a?(b={downloadStatus:g,validationResult:a},f[0]=g,f[1]=a,f[2]=b):b=f[2];return b}g["default"]=a}),98);
__d("useMWChatForward",["MWChatForwardDialog.entrypoint","MessengerWebUXLogger","react","react-compiler-runtime","useMWXEntryPointDialog"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;var i=b.useRef;function a(a){var b=d("react-compiler-runtime").c(11),e=a.dropToggle,f=a.forwardDialogType,g=a.messageID,h=a.onClose,j=a.onSend;a=i(null);var k;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(k={},b[0]=k):k=b[0];k=c("useMWXEntryPointDialog")(c("MWChatForwardDialog.entrypoint"),k);var l=k[0],m=c("MessengerWebUXLogger").useInteractionLogger();b[1]!==e||b[2]!==f||b[3]!==m||b[4]!==g||b[5]!==h||b[6]!==j||b[7]!==l?(k=function(){l({dropToggle:e,forwardDialogType:f,messageID:g,onSend:j},h,m==null?void 0:m("forward_message"))},b[1]=e,b[2]=f,b[3]=m,b[4]=g,b[5]=h,b[6]=j,b[7]=l,b[8]=k):k=b[8];k=k;b[9]!==k?(a={onClick:k,triggerRef:a},b[9]=k,b[10]=a):a=b[10];return a}g["default"]=a}),98);
__d("useMWChatMentionsDataSourceResolverConfig",["I64","LSMessagingThreadTypeUtil","LSThreadBitOffset","MWChatComposerMentionsTypeaheadDataSource","MWLSThread","createCometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport","react","useCometMentionsDataSourceResolverConfig"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useMemo;function a(a){var b=a.isAiBotMentionsEnabled,e=a.participants,f=a.threadFBID,g=a.triggerParticipantsSearch;a=d("MWLSThread").useThreadExn((i||(i=d("I64"))).of_string(f));var h=d("LSMessagingThreadTypeUtil").isGroup(a.threadType)&&d("LSThreadBitOffset").has(43,a);a=j(function(){return[{dataSource:new(c("MWChatComposerMentionsTypeaheadDataSource"))(e,f,g,b,h),matchStrategy:c("createCometAtSignComposerMentionsMatchStrategyWithInstagramHandleSupport")({minMatchLength:0})}]},[h,b,e,f,g]);return c("useCometMentionsDataSourceResolverConfig")(a,!0)}g["default"]=a}),98);
__d("useMWIsContactRestricted",["LSContactBitOffset","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("react-compiler-runtime").c(2),c;b[0]!==a?(c=a!=null&&d("LSContactBitOffset").has(66,a),b[0]=a,b[1]=c):c=b[1];a=c;return a}g["default"]=a}),98);
__d("useMWHasForwardAction",["I64","LSAuthorityLevel","LSBitFlag","LSContactBitOffset","LSIntEnum","LSMessagingThreadTypeUtil","MAWGetIsMediaDownloadStatusEnabled","MAWMsg","MWCMIsSubthreadContext.react","MWMessageDeliveryStatus","MWPThreadCapabilitiesContext","MWV2OneToOneThreadBlockedContext.react","MWXMAUtils","MessagingAttachmentType","gkx","isFeatureLimitEnabled","isMWBumpMessage","mwCMIsAnyCMThread","react-compiler-runtime","shouldHideMessagingActions","useIsReadOnlyFeatureLimitedWithThreadType","useMAWMediaStatusUIState","useMWFamilyCenterContext","useMWGetOtherUserContact","useMWIsContactRestricted"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e,f,g,j){var k=d("react-compiler-runtime").c(57);f=f===void 0?!1:f;j=j===void 0?!1:j;var l=d("MWCMIsSubthreadContext.react").useIsSubthreadContext();l=l.isSubthread;var m;k[0]!==l||k[1]!==a?(m=l&&!d("LSMessagingThreadTypeUtil").isCMSubthread(a),k[0]=l,k[1]=a,k[2]=m):m=k[2];l=m;k[3]!==a?(m=d("LSMessagingThreadTypeUtil").isDiscoverablePublicBroadcastChannel(a),k[3]=a,k[4]=m):m=k[4];m=m;var n;k[5]!==a?(n=d("LSMessagingThreadTypeUtil").isArmadilloSecure(a),k[5]=a,k[6]=n):n=k[6];n=n;var o=b.ephemeralDurationInSec,p;k[7]!==o?(p=o!=null?(h||(h=d("I64"))).gt(o,(h||(h=d("I64"))).zero):!1,k[7]=o,k[8]=p):p=k[8];o=p;p=c("useIsReadOnlyFeatureLimitedWithThreadType")(a)&&(!n||c("isFeatureLimitEnabled")());var q;k[9]!==b.displayedContentTypes?(q=(h||(h=d("I64"))).equal(b.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(4096)),k[9]=b.displayedContentTypes,k[10]=q):q=k[10];q=q;var r;k[11]!==b.displayedContentTypes?(r=(h||(h=d("I64"))).equal(b.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(134217728)),k[11]=b.displayedContentTypes,k[12]=r):r=k[12];r=r;var s=d("MWV2OneToOneThreadBlockedContext.react").useIsBlocked(),t;k[13]!==b.displayedContentTypes||k[14]!==b.sendStatusV2?(t=c("shouldHideMessagingActions")(b.displayedContentTypes,d("MWMessageDeliveryStatus").getFromSendStatus(b.sendStatusV2)),k[13]=b.displayedContentTypes,k[14]=b.sendStatusV2,k[15]=t):t=k[15];t=t;var u=c("useMWGetOtherUserContact")(b.threadKey,a,d("LSContactBitOffset").contactCapabilityFields);u=c("useMWIsContactRestricted")(u);var v;k[16]!==b.sendStatusV2||k[17]!==a?(v=c("mwCMIsAnyCMThread")(a)&&(h||(h=d("I64"))).equal(b.sendStatusV2,(i||(i=d("LSIntEnum"))).ofNumber(4)),k[16]=b.sendStatusV2,k[17]=a,k[18]=v):v=k[18];a=v;k[19]!==b.displayedContentTypes?(v=d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(2),b.displayedContentTypes),k[19]=b.displayedContentTypes,k[20]=v):v=k[20];v=v;var w;k[21]!==b?(w=c("isMWBumpMessage")(b),k[21]=b,k[22]=w):w=k[22];w=w;var x=d("MWPThreadCapabilitiesContext").useMWPThreadCapabilitiesContext();x=x.messageForwardEnabled;var y=d("useMWFamilyCenterContext").useMWFamilyCenterEnforcementsContext();y=y.familyCenterData;var z;k[23]!==e?(z=(e==null?void 0:e.attachmentType)!=null&&((h||(h=d("I64"))).equal(e.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").EPHEMERAL_IMAGE))||(h||(h=d("I64"))).equal(e.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").EPHEMERAL_VIDEO))),k[23]=e,k[24]=z):z=k[24];z=z;var A;k[25]!==e||k[26]!==n?(A=n&&(e==null?void 0:e.xmaContentType)!=null&&d("MWXMAUtils").isLocationShareXMA(e.xmaContentType),k[25]=e,k[26]=n,k[27]=A):A=k[27];A=A;var B=c("useMAWMediaStatusUIState")(e);B=B.downloadStatus;var C;k[28]!==e||k[29]!==n||k[30]!==B?(C=e!=null&&n&&!(h||(h=d("I64"))).equal(e.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA))&&d("MAWGetIsMediaDownloadStatusEnabled").getIsMediaDownloadStatusEnabled()&&B!=="downloaded",k[28]=e,k[29]=n,k[30]=B,k[31]=C):C=k[31];B=C;k[32]!==e||k[33]!==y||k[34]!==a||k[35]!==s||k[36]!==m||k[37]!==w||k[38]!==o||k[39]!==B||k[40]!==p||k[41]!==r||k[42]!==u||k[43]!==A||k[44]!==n||k[45]!==q||k[46]!==l||k[47]!==z||k[48]!==g||k[49]!==b||k[50]!==x||k[51]!==t||k[52]!==f?(C=(n?!o&&!q&&!r:!0)&&!l&&!s&&!u&&!p&&!b.isUnsent&&!a&&!d("MAWMsg").isPlaceholder(b)&&!w&&x&&(!m||m&&c("gkx")("461"))&&!f&&(h||(h=d("I64"))).gt(b.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC))&&(e!=null&&(h||(h=d("I64"))).equal(e.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA))&&(e.attachmentCta1Id!=null||e.attachmentCta2Id!=null||e.attachmentCta3Id!=null||e.defaultCtaId!=null)?e.isSharable:!0)&&(g==null||!g.hasMissingMessages&&!g.hasMissingMedia)&&!y.hasActiveMsgrFamilyCenterEnforcement&&!z&&!t&&!B&&!A,k[32]=e,k[33]=y,k[34]=a,k[35]=s,k[36]=m,k[37]=w,k[38]=o,k[39]=B,k[40]=p,k[41]=r,k[42]=u,k[43]=A,k[44]=n,k[45]=q,k[46]=l,k[47]=z,k[48]=g,k[49]=b,k[50]=x,k[51]=t,k[52]=f,k[53]=C):C=k[53];e=C;y=v&&e&&!j;k[54]!==e||k[55]!==y?(a={hasForwardAction:e,shouldShowForwardAction:y},k[54]=e,k[55]=y,k[56]=a):a=k[56];return a}g["default"]=a}),98);
__d("useMWV2ForwardMessage",["$InternalEnum","CometRelay","FBLogger","I64","Int64Hooks","LSIntEnum","LSMessagingThreadTypeUtil","MAWDbMsg","MAWExternalId","MAWMessageSendReporterV2","MAWThreadId","MAWVerifyThreadCutover","MWChatMessageId","MWChatThreadId","MWLSForwardMessage","MWPActor.react","MWSharedMsgLogUtils","Promise","ReQL","ReQLSuspense","WAResultOrError","asyncToGeneratorRuntime","cr:9756","cr:9757","cr:9758","cr:9759","gkx","promiseDone","react-compiler-runtime","sendToSentQPLLogger","unrecoverableViolation","useGetForwardSource","useIsSecureMessage","useLSMessagingSource","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads).getKeyRange(b))}function m(a,b,c){var e;return(e=d("ReQL")).firstAsync(e.mergeJoin(e.fromTableAscending(a.tables.participants).getKeyRange(b),e.fromTableAscending(a.tables.contacts)).filter(function(a){a[0];a=a[1];return!(k||(k=d("I64"))).equal(a.id,c)}))}function n(a,b,c){var e=d("react-compiler-runtime").c(20),g=b.messageId,h=b.threadKey;e[0]!==a.tables.attachments||e[1]!==g||e[2]!==h?(b=function(){return d("ReQL").fromTableAscending(a.tables.attachments).getKeyRange(h,g)},e[0]=a.tables.attachments,e[1]=g,e[2]=h,e[3]=b):b=e[3];var i;e[4]!==a||e[5]!==g||e[6]!==h?(i=[a,g,h],e[4]=a,e[5]=g,e[6]=h,e[7]=i):i=e[7];b=d("ReQLSuspense").useArray(b,i,f.id+":102");e[8]!==c||e[9]!==a.tables.attachments||e[10]!==g||e[11]!==h?(i=function(){return c!=null?d("ReQL").fromTableAscending(a.tables.attachments).getKeyRange(h,g,c):d("ReQL").empty()},e[8]=c,e[9]=a.tables.attachments,e[10]=g,e[11]=h,e[12]=i):i=e[12];var j;e[13]!==c||e[14]!==a||e[15]!==g||e[16]!==h?(j=[c,a,g,h],e[13]=c,e[14]=a,e[15]=g,e[16]=h,e[17]=j):j=e[17];i=d("ReQLSuspense").useFirst(i,j,f.id+":111");j=b.length>0?b[0]:void 0;if(c!=null){i=(i=i)!=null?i:j;e[18]!==i?(j=i!=null?[i]:[],e[18]=i,e[19]=j):j=e[19];return j}return b}function o(){var a=(j||(j=c("useReStore")))();return d("Int64Hooks").useCallbackInt64(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e,f,g,i,j,k,n,o){var q=d("MWChatThreadId").toThreadKey(j),r=d("MWChatThreadId").getMessagingThreadType(j);j=(yield d("MAWVerifyThreadCutover").verifyThreadCutover((h||(h=b("Promise"))).resolve(a),q));var s=(yield h.all([d("MAWThreadId").isSecureThreadId(a.tables,q),l(a,q),m(a,q,g)])),t=s[0],u=s[1];s=s[2];t=t||j;try{if(b("cr:9757")!=null&&!t){d("sendToSentQPLLogger").addSendToSentAnnotations(k,{string:{forward_type:p.SecureToOpen}});o!=null?yield (h||(h=b("Promise"))).allSettled([o.messagesAndAttachments.map(function(c){return b("cr:9757").forwardMessage(a,q,r,c.message,i,(c=c.attachment)!=null?c:void 0,g,n)})]):yield b("cr:9757").forwardMessage(a,q,r,e,i,f[0],g,n);d("sendToSentQPLLogger").markSendToSentSuccess(k);return d("WAResultOrError").makeResult({description:"open message",messageType:"fixMe"})}j=d("MAWDbMsg").toMsgId(e.messageId);if(j==null)throw c("unrecoverableViolation")("Message does not have an id","messenger_web_sharing");if(b("cr:9756")!=null){d("sendToSentQPLLogger").addSendToSentAnnotations(k,{string:{forward_type:p.SecureToSecure}});if(o!=null){t=o.messagesAndAttachments.map(function(a){return d("MAWDbMsg").toMsgId(a.message.messageId)}).filter(Boolean);f=(yield b("cr:9756").forwardMessageBatch(a,q,t,n,k))}else f=(yield b("cr:9756").forwardMessage(a,q,j,n,k));b("cr:9759")!=null&&u!=null&&(yield b("cr:9759")(a,u,s,d("LSMessagingThreadTypeUtil").isOneToOne(u.threadType)));if(((e=f)==null?void 0:e.success)===!1)return d("WAResultOrError").makeError(f.error);t=(o=f)==null?void 0:o.value;return t!=null?d("WAResultOrError").makeResult(t):d("WAResultOrError").makeResult({description:"removal pending rollout of maw_s2s_reporter_unification",messageType:"fixMe"})}throw c("unrecoverableViolation")("We won't reach to this step, if you are in QE, you should use secure forward","messenger_web_sharing")}catch(a){c("gkx")("8783")||d("sendToSentQPLLogger").markSendToSentFail(k,"failed_forwarding_message",a);c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("MW Fail forwarding a message");throw a}});return function(a,b,c,d,f,g,h,i){return e.apply(this,arguments)}}(),[a])}var p=b("$InternalEnum")({SecureToOpen:"secure_to_open",OpenToOpen:"open_to_open",SecureToSecure:"secure_to_secure",OpenToSecure:"open_to_secure"});function a(a,e,f,g){var q=d("react-compiler-runtime").c(41),r=(j||(j=c("useReStore")))(),s=n(r,a,f),t;q[0]!==e?(t={fallbackThreadType:e},q[0]=e,q[1]=t):t=q[1];var u=c("useIsSecureMessage")(r,a,t),v=d("MWPActor.react").useActor(),w=!(k||(k=d("I64"))).equal(v,a.senderId),x=d("MWLSForwardMessage").useForwardMessage(),y=d("MWLSForwardMessage").useForwardAttachment(),z=c("useGetForwardSource")();q[2]!==a.messageId||q[3]!==a.threadKey||q[4]!==a.timestampMs?(e=d("MWChatMessageId").makeSent((k||(k=d("I64"))).to_string(a.threadKey),a.messageId,k.to_string(a.timestampMs)),q[2]=a.messageId,q[3]=a.threadKey,q[4]=a.timestampMs,q[5]=e):e=q[5];var A=e,B=d("CometRelay").useRelayEnvironment(),C=o();q[6]!==a.displayedContentTypes?(t=d("MWSharedMsgLogUtils").getMessageTypeFromDisplayedContentType(a.displayedContentTypes),q[6]=a.displayedContentTypes,q[7]=t):t=q[7];var D=t,E=c("useLSMessagingSource")();q[8]!==s||q[9]!==r||q[10]!==w||q[11]!==E||q[12]!==g||q[13]!==a||q[14]!==D||q[15]!==C||q[16]!==v||q[17]!==z?(e=function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=d("MWChatThreadId").toThreadKey(b);e=(yield d("MAWThreadId").getThreadFromJid(r.tables,e));var f=function(c){return C(a,s,v,w,b,c,z,g)};if(c("gkx")("8783"))yield d("MAWMessageSendReporterV2").MAWMessageSendReporterV2({composerEntrypoint:"useMWV2ForwardMessage",extraAnnotations:{string:{attachment_type:"forward",message_type:D}},lsSource:E,messageTypeParamsArgs:{mediaGroupInfo:g},thread:e},f,r);else{e=d("sendToSentQPLLogger").markSendToSentStartWithAnnotation(e,{mediaGroupInfo:g},(i||(i=d("LSIntEnum"))).unwrapIntEnum(z),{string:{attachment_type:"forward",message_type:D}});yield f(e)}});return function(a){return e.apply(this,arguments)}}(),t=[r,v,E,g,z,C,a,s,w,D],q[8]=s,q[9]=r,q[10]=w,q[11]=E,q[12]=g,q[13]=a,q[14]=D,q[15]=C,q[16]=v,q[17]=z,q[18]=e,q[19]=t):(e=q[18],t=q[19]);var F=d("Int64Hooks").useCallbackInt64(e,t);q[20]!==f||q[21]!==s||q[22]!==r||q[23]!==y||q[24]!==x||q[25]!==w||q[26]!==E||q[27]!==g||q[28]!==a||q[29]!==D||q[30]!==A||q[31]!==B||q[32]!==v||q[33]!==z?(e=function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var j=d("MWChatThreadId").toThreadKey(e),k=d("MWChatThreadId").getMessagingThreadType(e),n=(yield (h||(h=b("Promise"))).all([d("MAWThreadId").isSecureThreadId(r.tables,j),l(r,j),m(r,j,v),d("MAWVerifyThreadCutover").verifyThreadCutover(h.resolve(r),j),d("MAWThreadId").getThreadFromJid(r.tables,j)])),o=n[0],q=n[1],t=n[2],u=n[3],C=n[4];n=o||u;var F=function(){var a=d("sendToSentQPLLogger").markSendToSentStart();if(C!=null){var b=d("MWSharedMsgLogUtils").getMessageTypeParams({threadType:C.threadType});c("promiseDone")(d("MWSharedMsgLogUtils").getSendToSentAnnotations(C,b,(i||(i=d("LSIntEnum"))).unwrapIntEnum(z)),function(b){b.string=babelHelpers["extends"]({},b.string,{attachment_type:"forward",message_type:D}),d("sendToSentQPLLogger").addSendToSentAnnotations(a,b)})}d("sendToSentQPLLogger").addSendToSentAnnotations(a,{string:{forward_type:p.OpenToSecure,message_type:D}});return a};if(b("cr:9758")!=null&&n){var G=function(c,d){return function(e){return b("cr:9758").forwardMessage(B,r,j,a,w,d,z,(e=e)!=null?e:void 0,c)}};if(s.length===0){o=d("MAWExternalId").generateExternalId();if(c("gkx")("8783"))c("promiseDone")(d("MAWMessageSendReporterV2").MAWMessageSendReporterV2({composerEntrypoint:"useMWV2ForwardMessage",externalId:o,extraAnnotations:{string:{attachment_type:"forward",forward_type:p.OpenToSecure,message_type:D}},lsSource:E,messageTypeParamsArgs:{mediaGroupInfo:g},thread:C},G(o,void 0),r));else{u=F();yield G(o,void 0)(u);d("sendToSentQPLLogger").markSendToSentSuccess(u)}}else yield (h||(h=b("Promise"))).all(s.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("MAWExternalId").generateExternalId();if(c("gkx")("8783"))yield d("MAWMessageSendReporterV2").MAWMessageSendReporterV2({composerEntrypoint:"useMWV2ForwardMessage",externalId:b,extraAnnotations:{string:{attachment_type:"forward",forward_type:p.OpenToSecure,message_type:D}},lsSource:E,messageTypeParamsArgs:{mediaGroupInfo:g},thread:C},G(b,a),r);else{var e=F();try{yield G(b,a)(e),d("sendToSentQPLLogger").markSendToSentSuccess(e)}catch(a){b=a;d("sendToSentQPLLogger").markSendToSentFail(e,"failed_forwarding_message",b);c("FBLogger")("messenger_e2ee_web").catching(b).mustfix("MW Fail forwarding a message");throw b}}});return function(b){return a.apply(this,arguments)}}()));b("cr:9759")!=null&&q!=null&&b("cr:9759")(r,q,t,d("LSMessagingThreadTypeUtil").isOneToOne(q.threadType))}else if(!n){o=F();try{d("sendToSentQPLLogger").addSendToSentAnnotations(o,{string:{forward_type:p.OpenToOpen,message_type:D}});f==null?x(j,k,A):y(e,f);d("sendToSentQPLLogger").markSendToSentSuccess(o);return}catch(a){u=a;d("sendToSentQPLLogger").markSendToSentFail(o,"failed_forwarding_message",u);c("FBLogger")("messenger_e2ee_web").catching(u).mustfix("MW Fail forwarding a message");throw u}}});return function(a){return e.apply(this,arguments)}}(),t=[r,v,z,f,B,a,w,g,E,s,x,A,y,D],q[20]=f,q[21]=s,q[22]=r,q[23]=y,q[24]=x,q[25]=w,q[26]=E,q[27]=g,q[28]=a,q[29]=D,q[30]=A,q[31]=B,q[32]=v,q[33]=z,q[34]=e,q[35]=t):(e=q[34],t=q[35]);var G=d("Int64Hooks").useCallbackInt64(e,t);q[36]!==G||q[37]!==F||q[38]!==u?(e=function(){return u?F:G},t=[u,F,G],q[36]=G,q[37]=F,q[38]=u,q[39]=e,q[40]=t):(e=q[39],t=q[40]);return d("Int64Hooks").useMemoInt64(e,t)}g.ForwardType=p;g.useMWV2ForwardMessage=a}),98);
__d("useMWV2MessageForwardAction",["I64","LSBitFlag","LSIntEnum","MWChatMessageId","MWV2LogMessageClick","MWV2MessageRowIsRowFocusedContext.react","gkx","promiseDone","qex","react","react-compiler-runtime","useMWChatForward","useMWV2ForwardMessage","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");b.useCallback;var l=b.useContext;function a(a,b,e){var f=d("react-compiler-runtime").c(20),g=(h||(h=c("useReStore")))(),k=c("gkx")("20836"),p=!k&&a;k=!k&&c("qex")._("205")===!0;p=p?k?"cross_transport":"secure":k?"cross_transport":"open_";f[0]!==b.messageId||f[1]!==b.threadKey||f[2]!==b.timestampMs?(k=d("MWChatMessageId").makeSent((i||(i=d("I64"))).to_string(b.threadKey),b.messageId,i.to_string(b.timestampMs)),f[0]=b.messageId,f[1]=b.threadKey,f[2]=b.timestampMs,f[3]=k):k=f[3];k=k;var q=d("useMWV2ForwardMessage").useMWV2ForwardMessage(b,e);e=l(d("MWV2MessageRowIsRowFocusedContext.react").context);var r=e.setFocused,s=e.setIsDialogOpened;e=b.stickerId;a=!a;e=d("LSBitFlag").has((j||(j=d("LSIntEnum"))).ofNumber(1),b.displayedContentTypes)&&!b.textHasLinks||d("LSBitFlag").has((j||(j=d("LSIntEnum"))).ofNumber(16384),b.displayedContentTypes)||d("LSBitFlag").has((j||(j=d("LSIntEnum"))).ofNumber(2),b.displayedContentTypes)||d("LSBitFlag").has((j||(j=d("LSIntEnum"))).ofNumber(4),b.displayedContentTypes)||d("LSBitFlag").has((j||(j=d("LSIntEnum"))).ofNumber(512),b.displayedContentTypes)||d("LSBitFlag").has((j||(j=d("LSIntEnum"))).ofNumber(1024),b.displayedContentTypes)||e!=null&&(i||(i=d("I64"))).equal(e,(i||(i=d("I64"))).of_string("369239263222822"))||e!=null&&(i||(i=d("I64"))).equal(e,(i||(i=d("I64"))).of_string("369239343222814"))||e!=null&&(i||(i=d("I64"))).equal(e,(i||(i=d("I64"))).of_string("369239383222810"));a=a&&!e;f[4]!==r||f[5]!==s?(e=function(){s(o),r(n)},f[4]=r,f[5]=s,f[6]=e):e=f[6];e=e;var t;f[7]!==q?(t=function(a){return c("promiseDone")(q(a))},f[7]=q,f[8]=t):t=f[8];t=t;var u;f[9]!==p||f[10]!==k||f[11]!==a||f[12]!==e||f[13]!==t?(u={dropToggle:a,forwardDialogType:p,messageID:k,onClose:e,onSend:t},f[9]=p,f[10]=k,f[11]=a,f[12]=e,f[13]=t,f[14]=u):u=f[14];var v=c("useMWChatForward")(u);f[15]!==g||f[16]!==v||f[17]!==b||f[18]!==s?(p=function(){d("MWV2LogMessageClick").log(g,b,44),v!=null&&(s(m),v.onClick())},f[15]=g,f[16]=v,f[17]=b,f[18]=s,f[19]=p):p=f[19];return p}function m(){return!0}function n(){return!0}function o(){return!1}g["default"]=a}),98);